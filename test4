repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local RemoteEvent = ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild("Remote"):WaitForChild("RemoteEvent")
local PickupRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Pickups"):WaitForChild("CollectPickup")

local COIN_TARGET = 3500000000
local TICKET_TARGET = 1000000000
local OVERWORLD = "The Overworld"
local FARM_CFRAME = CFrame.new(-33.90,15971.73,37.79)

local claimed = {}

local function getData()
    return LocalData:Get() or {}
end

local function fmt(n)
    n = tonumber(n) or 0
    if n >= 1e12 then return string.format("%.2fT", n/1e12) end
    if n >= 1e9 then return string.format("%.2fB", n/1e9) end
    if n >= 1e6 then return string.format("%.2fM", n/1e6) end
    if n >= 1e3 then return string.format("%.2fK", n/1e3) end
    return tostring(n)
end

local function ensureGui()
    local g = PlayerGui:FindFirstChild("StatusUI")
    if g then return g end
    g = Instance.new("ScreenGui")
    g.Name = "StatusUI"
    g.ResetOnSpawn = false
    g.IgnoreGuiInset = true
    g.Parent = PlayerGui
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1,0,1,0)
    f.Position = UDim2.new(0,0,0,0)
    f.BackgroundColor3 = Color3.new(0,0,0)
    f.Parent = g
    local t = Instance.new("TextLabel")
    t.Name = "Label"
    t.Size = UDim2.new(1,0,1,0)
    t.Position = UDim2.new(0,0,0,0)
    t.BackgroundTransparency = 1
    t.TextColor3 = Color3.new(1,1,1)
    t.TextWrapped = true
    t.TextScaled = true
    t.TextXAlignment = Enum.TextXAlignment.Center
    t.TextYAlignment = Enum.TextYAlignment.Center
    t.Font = Enum.Font.GothamBold
    t.Text = ""
    t.Parent = f
    return g
end

local gui = ensureGui()
player.CharacterAdded:Connect(function()
    task.wait(0.5)
    ensureGui()
end)

local frame = gui:FindFirstChildOfClass("Frame")
local label = frame:FindFirstChild("Label")

local emojis = {"üöÄ","‚öôÔ∏è","üåç","üí∞","üéüÔ∏è","‚ùÑÔ∏è"}
task.spawn(function()
    local ei = 1
    while true do
        local d = getData()
        local wc, wt = 0, 0
        for _,v in pairs(d.WorldsUnlocked or {}) do
            wt += 1
            if v then wc += 1 end
        end
        label.Text =
            emojis[ei].." "..player.Name.."\n\n"..
            "Worlds "..wc.."/"..wt.."\n\n"..
            "Coins "..fmt(d.Coins).."\n"..
            "Tickets "..fmt(d.Tickets).."\n"..
            "Pearls "..fmt(d.Pearls)
        ei = ei % #emojis + 1
        task.wait(0.5)
    end
end)

local function waitForIslands(world)
    local w
    repeat
        w = Workspace.Worlds:FindFirstChild(world)
        task.wait(0.5)
    until w and w:FindFirstChild("Islands")
    return w.Islands
end

local function unlockIslands(world)
    if not firetouchinterest then return end
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    local islands = waitForIslands(world)
    while true do
        local unlocked = getData().AreasUnlocked or {}
        local left = {}
        for _,i in ipairs(islands:GetChildren()) do
            if not unlocked[i.Name] then table.insert(left,i) end
        end
        if #left == 0 then break end
        for _,i in ipairs(left) do
            local island = i:FindFirstChild("Island")
            if island then
                for _,p in ipairs(island:GetDescendants()) do
                    if p:IsA("BasePart") then
                        firetouchinterest(hrp,p,0)
                        task.wait()
                        firetouchinterest(hrp,p,1)
                    end
                end
            end
        end
        task.wait(0.5)
    end
end

local function allIslandsUnlocked(world)
    local unlocked = getData().AreasUnlocked or {}
    local w = Workspace.Worlds:FindFirstChild(world)
    if not w or not w:FindFirstChild("Islands") then return false end
    for _,i in ipairs(w.Islands:GetChildren()) do
        if not unlocked[i.Name] then return false end
    end
    return true
end

local function tp(cf)
    local char = player.Character or player.CharacterAdded:Wait()
    char:WaitForChild("HumanoidRootPart").CFrame = cf
end

local function pressB()
    VirtualInputManager:SendKeyEvent(true,Enum.KeyCode.B,false,game)
    task.wait(0.02)
    VirtualInputManager:SendKeyEvent(false,Enum.KeyCode.B,false,game)
end

unlockIslands(OVERWORLD)
repeat task.wait(0.5) until allIslandsUnlocked(OVERWORLD)

if (getData().Coins or 0) < COIN_TARGET then
    tp(FARM_CFRAME)
    task.wait(0.5)
    tp(FARM_CFRAME)
    for i=1,3 do pressB() task.wait(1) end
    while true do
        if (getData().Coins or 0) >= COIN_TARGET then break end
        local r = Workspace:FindFirstChild("Rendered")
        if r then
            local t = r:GetChildren()[15]
            if t then
                for _,o in ipairs(t:GetChildren()) do
                    if not claimed[o.Name] then
                        claimed[o.Name] = true
                        pcall(function()
                            PickupRemote:FireServer(o.Name)
                            o:Destroy()
                        end)
                    end
                end
            end
        end
        task.wait(0.1)
    end
end

for w,u in pairs(getData().WorldsUnlocked or {}) do
    if w ~= OVERWORLD and not u then
        RemoteEvent:FireServer("UnlockWorld",w)
        task.wait(0.5)
    end
end

RemoteEvent:FireServer("WorldTeleport","Minigame Paradise")
task.wait(3)
for i=1,3 do pressB() task.wait(1) end

unlockIslands("Minigame Paradise")
repeat task.wait(0.5) until allIslandsUnlocked("Minigame Paradise")

if (getData().Tickets or 0) < TICKET_TARGET then
    repeat task.wait(1) until (getData().Tickets or 0) >= TICKET_TARGET
end

RemoteEvent:FireServer("UnlockWorld","Seven Seas")
RemoteEvent:FireServer("WorldTeleport","Seven Seas")

getgenv().running = not getgenv().running

local pots = {
    {"UsePotion","Speed",7,10},
    {"UsePotion","Lucky",7,10},
    {"UsePotion","Mythic",7,10},
    {"UsePotion","Egg Elixir",1,10},
    {"UsePotion","Infinity Elixir",1,10},
    {"UsePotion","Festive Elixir",4,10},
    {"UsePotion","Festive Infinity Elixir",1,10},
    {"UsePotion","Ultra Infinity Elixir",1,10},
}

if not getgenv().running then
    RunService:UnbindFromRenderStep("PotionSpam")
else
    RunService:BindToRenderStep("PotionSpam",Enum.RenderPriority.First.Value,function()
        if not getgenv().running then return end
        for i=1,60 do
            for _,a in ipairs(pots) do
                RemoteEvent:FireServer(unpack(a))
            end
        end
    end)
end
