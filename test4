getgenv().waitTime = 2.5

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
repeat task.wait() until player.Character
local char = player.Character
local hrp = char:WaitForChild("HumanoidRootPart")

local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)
local RemoteEvent = ReplicatedStorage.Shared.Framework.Network.Remote.RemoteEvent
local RemoteFunction = ReplicatedStorage.Shared.Framework.Network.Remote.RemoteFunction

for _, world in pairs(Workspace.Worlds:GetChildren()) do
    if world.Name ~= "Minigame Paradise" then
        world:Destroy()
    end
end

local activeRift
local lastKeyAmount
local lastKeyChange = tick()

local function getAmount(name)
    local data = LocalData:Get()
    return (data and data.Powerups and data.Powerups[name]) or 0
end

local function setNoClip(state)
    for _, v in pairs(char:GetDescendants()) do
        if v:IsA("BasePart") then
            v.CanCollide = not state
        end
    end
end

local function getChest()
    if not activeRift then return end
    local chest = activeRift:FindFirstChild("Chest", true)
    if chest then
        return chest:FindFirstChildWhichIsA("BasePart")
    end
end

local function teleport()
    local chest = getChest()
    if not chest then return end
    setNoClip(true)
    hrp.CFrame = chest.CFrame
    task.wait()
    setNoClip(false)
end

local function bindRift(rift)
    if activeRift then return end
    activeRift = rift
    teleport()
    rift.DescendantAdded:Connect(function(d)
        if d.Name == "Chest" then
            teleport()
        end
    end)
end

task.spawn(function()
    local rendered = Workspace:WaitForChild("Rendered")
    local rifts = rendered:WaitForChild("Rifts")
    for _, r in pairs(rifts:GetChildren()) do
        if r.Name == "dice-rift" then
            bindRift(r)
            break
        end
    end
    rifts.ChildAdded:Connect(function(r)
        if r.Name == "dice-rift" then
            bindRift(r)
        end
    end)
end)

task.spawn(function()
    while true do
        if activeRift then
            local current = getAmount("Dice Key")
            if lastKeyAmount == nil then
                lastKeyAmount = current
                lastKeyChange = tick()
            elseif current ~= lastKeyAmount then
                lastKeyAmount = current
                lastKeyChange = tick()
            elseif current > 0 and tick() - lastKeyChange >= 30 then
                teleport()
                lastKeyChange = tick()
            end
        end
        task.wait(1)
    end
end)

task.spawn(function()
    while true do
        if activeRift and getAmount("Dice Key") > 0 then
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.R, false, game)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.R, false, game)
        end
        task.wait(0.05)
    end
end)

task.spawn(function()
    while true do
        if activeRift then
            local chest = getChest()
            if not chest then
                local checks = math.random(1,10)
                local found = false
                for _ = 1, checks do
                    if getChest() then
                        found = true
                        break
                    end
                    task.wait(1)
                end
                if not found then
                    RemoteFunction:InvokeServer(
                        "SummonRift",
                        {
                            Name = "dice-rift",
                            Type = "Chest",
                            Time = 5,
                            World = "Minigame Paradise"
                        }
                    )
                end
            end
        end
        task.wait(2)
    end
end)

local gui = Instance.new("ScreenGui")
gui.ResetOnSpawn = false
gui.Parent = player.PlayerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.fromOffset(200,200)
frame.Position = UDim2.new(0.5,-100,0,8)
frame.BorderSizePixel = 0
frame.Parent = gui
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,14)

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0,4)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
layout.Parent = frame

local pad = Instance.new("UIPadding")
pad.PaddingTop = UDim.new(0,6)
pad.PaddingBottom = UDim.new(0,6)
pad.PaddingLeft = UDim.new(0,6)
pad.PaddingRight = UDim.new(0,6)
pad.Parent = frame

local function label(h,b)
    local l = Instance.new("TextLabel")
    l.Size = UDim2.new(1,0,0,h)
    l.BackgroundTransparency = 1
    l.TextScaled = true
    l.TextWrapped = true
    l.Font = b and Enum.Font.GothamBold or Enum.Font.Gotham
    l.TextColor3 = Color3.new(1,1,1)
    local c = Instance.new("UITextSizeConstraint")
    c.MinTextSize = 12
    c.MaxTextSize = b and 22 or 18
    c.Parent = l
    l.Parent = frame
    return l
end

local nameLabel = label(32,true)
local diceKeyLabel = label(40,true)
local superTicketLabel = label(36,false)
local goldenDiceLabel = label(36,false)

RunService.Heartbeat:Connect(function()
    local dice = getAmount("Dice Key")
    frame.BackgroundColor3 = dice > 0 and Color3.fromRGB(40,120,255) or Color3.fromRGB(200,45,45)
    nameLabel.Text = "ğŸ‘¤ "..player.Name
    diceKeyLabel.Text = "ğŸ² Dice Key : "..dice
    superTicketLabel.Text = "ğŸŸï¸ Super Ticket : "..getAmount("Super Ticket")
    goldenDiceLabel.Text = "âœ¨ Golden Dice : "..getAmount("Golden Dice")
end)
