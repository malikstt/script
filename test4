repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local RE = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")
    :WaitForChild("RemoteEvent")

local CHRISTMAS = "Christmas World"
local TP_AFTER_GIFTS = CFrame.new(-2566.67, 25681.74, 1150.58)
local SNOWFLAKE_MAX = 5000000000
local SNOWFLAKE_MIN = 50000

local function data()
    return LocalData:Get() or {}
end

local function isWorldUnlocked(world)
    local wu = data().WorldsUnlocked
    return wu and wu[world] == true
end

local function unlockWorld(world)
    RE:FireServer("UnlockWorld", world)
end

local function teleportWorld(world)
    RE:FireServer("WorldTeleport", world)
end

local function tp(cf)
    local c = player.Character or player.CharacterAdded:Wait()
    c:WaitForChild("HumanoidRootPart").CFrame = cf
end

local function pressE()
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
    task.wait(0.02)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
end

local function makeFailUI()
    local gui = Instance.new("ScreenGui")
    gui.Name = "FailUI"
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Parent = PlayerGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.fromOffset(200,200)
    frame.Position = UDim2.fromScale(0.5,0.5)
    frame.AnchorPoint = Vector2.new(0.5,0.5)
    frame.BackgroundColor3 = Color3.new(0,0,0)
    frame.Parent = gui

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.fromScale(0.8,0.25)
    btn.Position = UDim2.fromScale(0.5,0.5)
    btn.AnchorPoint = Vector2.new(0.5,0.5)
    btn.Text = "DISABLE UI"
    btn.Font = Enum.Font.GothamBold
    btn.TextScaled = true
    btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Parent = frame

    btn.MouseButton1Click:Connect(function()
        gui.Enabled = not gui.Enabled
    end)
end

unlockWorld(CHRISTMAS)
task.wait(6)

if not isWorldUnlocked(CHRISTMAS) then
    makeFailUI()
else
    teleportWorld(CHRISTMAS)
end

task.wait(5)

local function activateAllGifts()
    local cw = Workspace.Worlds:FindFirstChild(CHRISTMAS)
    if not cw then return end
    local gifts = cw:FindFirstChild("GiveGifts")
    if not gifts then return end
    for _,v in ipairs(gifts:GetChildren()) do
        local act = v:FindFirstChild("Activation")
        if act and act:IsA("BasePart") then
            tp(act.CFrame + Vector3.new(0,5,0))
            task.wait(0.2)
        end
    end
end

local function spamEUntilMin()
    while (data().Snowflakes or 0) > SNOWFLAKE_MIN do
        pressE()
        task.wait(0.05)
    end
end

while (data().Snowflakes or 0) < SNOWFLAKE_MAX do
    activateAllGifts()
    task.wait(1)
    tp(TP_AFTER_GIFTS)
    task.wait(0.5)
    spamEUntilMin()
    task.wait(1)
end
