local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local RemoteEvent = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")
    :WaitForChild("RemoteEvent")

local PickupRemote = ReplicatedStorage
    :WaitForChild("Remotes")
    :WaitForChild("Pickups")
    :WaitForChild("CollectPickup")

local COIN_TARGET = 3500000000
local TICKET_TARGET = 1000000000
local OVERWORLD = "The Overworld"
local FARM_CFRAME = CFrame.new(-33.90, 15971.73, 37.79)

local claimed = {}

local function getData()
    return LocalData:Get() or {}
end

local function format(n)
    if not n then return "0" end
    if n >= 1e12 then return string.format("%.2fT", n/1e12) end
    if n >= 1e9 then return string.format("%.2fB", n/1e9) end
    if n >= 1e6 then return string.format("%.2fM", n/1e6) end
    if n >= 1e3 then return string.format("%.2fK", n/1e3) end
    return tostring(n)
end

local function waitForIslands(world)
    local w
    repeat
        w = Workspace.Worlds:FindFirstChild(world)
        task.wait(1)
    until w and w:FindFirstChild("Islands")
    return w.Islands
end

local function unlockIslands(world)
    if not firetouchinterest then return end
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    local islandsFolder = waitForIslands(world)
    while true do
        local unlocked = (getData().AreasUnlocked) or {}
        local remaining = {}
        for _, isl in ipairs(islandsFolder:GetChildren()) do
            if not unlocked[isl.Name] then
                table.insert(remaining, isl)
            end
        end
        if #remaining == 0 then break end
        for _, isl in ipairs(remaining) do
            local island = isl:FindFirstChild("Island")
            if island then
                for _, part in ipairs(island:GetDescendants()) do
                    if part:IsA("BasePart") then
                        firetouchinterest(hrp, part, 0)
                        task.wait()
                        firetouchinterest(hrp, part, 1)
                    end
                end
            end
        end
        task.wait(1)
    end
end

local function allIslandsUnlocked(world)
    local unlocked = (getData().AreasUnlocked) or {}
    local w = Workspace.Worlds:FindFirstChild(world)
    if not w or not w:FindFirstChild("Islands") then return false end
    for _, isl in ipairs(w.Islands:GetChildren()) do
        if not unlocked[isl.Name] then
            return false
        end
    end
    return true
end

local function tp(cf)
    local char = player.Character or player.CharacterAdded:Wait()
    char:WaitForChild("HumanoidRootPart").CFrame = cf
end

local function pressB()
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.B, false, game)
    task.wait(0.02)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.B, false, game)
end

unlockIslands(OVERWORLD)
repeat task.wait(1) until allIslandsUnlocked(OVERWORLD)

tp(FARM_CFRAME)
task.wait(0.5)
tp(FARM_CFRAME)

for i=1,3 do
    pressB()
    task.wait(1)
end

while true do
    local d = getData()
    if d.Coins and d.Coins >= COIN_TARGET then break end
    local rendered = Workspace:FindFirstChild("Rendered")
    if rendered then
        local target = rendered:GetChildren()[15]
        if target then
            for _, obj in ipairs(target:GetChildren()) do
                if not claimed[obj.Name] then
                    claimed[obj.Name] = true
                    pcall(function()
                        PickupRemote:FireServer(obj.Name)
                        obj:Destroy()
                    end)
                end
            end
        end
    end
    task.wait(0.1)
end

for worldName, unlocked in pairs((getData().WorldsUnlocked) or {}) do
    if worldName ~= OVERWORLD and not unlocked then
        RemoteEvent:FireServer("UnlockWorld", worldName)
        task.wait(1)
    end
end

RemoteEvent:FireServer("WorldTeleport","Minigame Paradise")
task.wait(3)

for i=1,3 do
    pressB()
    task.wait(1)
end

unlockIslands("Minigame Paradise")
repeat task.wait(1) until allIslandsUnlocked("Minigame Paradise")

while true do
    local d = getData()
    if d.Tickets and d.Tickets >= TICKET_TARGET then break end
    task.wait(1)
end

RemoteEvent:FireServer("UnlockWorld","Seven Seas")
RemoteEvent:FireServer("WorldTeleport","Seven Seas")

getgenv().running = not getgenv().running

local pots = {
    {"UsePotion","Speed",7,10},
    {"UsePotion","Lucky",7,10},
    {"UsePotion","Mythic",7,10},
    {"UsePotion","Egg Elixir",1,10},
    {"UsePotion","Infinity Elixir",1,10},
    {"UsePotion","Festive Elixir",4,10},
    {"UsePotion","Festive Infinity Elixir",1,10},
    {"UsePotion","Ultra Infinity Elixir",1,10},
}

if not getgenv().running then
    RunService:UnbindFromRenderStep("PotionSpam")
else
    RunService:BindToRenderStep("PotionSpam",Enum.RenderPriority.First.Value,function()
        if not getgenv().running then return end
        for i=1,60 do
            for _,a in ipairs(pots) do
                RemoteEvent:FireServer(unpack(a))
            end
        end
    end)
end

local gui = Instance.new("ScreenGui",player:WaitForChild("PlayerGui"))
local frame = Instance.new("Frame",gui)
frame.Size = UDim2.fromScale(1,1)
frame.BackgroundColor3 = Color3.new(0,0,0)

local label = Instance.new("TextLabel",frame)
label.Size = UDim2.fromScale(1,1)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.new(1,1,1)
label.TextWrapped = true
label.TextScaled = true
label.Font = Enum.Font.GothamBold

local emojis = {"üöÄ","‚öôÔ∏è","üåç","üí∞","üéüÔ∏è","‚ùÑÔ∏è"}
local ei = 1

task.spawn(function()
    while true do
        local d = getData()
        local wc, wt = 0, 0
        for _,v in pairs(d.WorldsUnlocked or {}) do
            wt += 1
            if v then wc += 1 end
        end
        label.Text =
            emojis[ei].." "..player.Name.."\n\n"..
            "Worlds "..wc.."/"..wt.."\n\n"..
            "Coins "..format(d.Coins).."\n"..
            "Tickets "..format(d.Tickets).."\n"..
            "Pearls "..format(d.Pearls)
        ei = ei % #emojis + 1
        task.wait(0.5)
    end
end)
