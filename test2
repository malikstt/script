local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local ws = workspace

local lp = Players.LocalPlayer
local keep = {}
local function k(x) if x then keep[x]=true end end

local function protectCharacter(c)
    if not c then return end
    k(c)
    for _,v in ipairs(c:GetDescendants()) do k(v) end
    if c:FindFirstChild("HumanoidRootPart") then
        pcall(function() c:WaitForChild("HumanoidRootPart").CFrame = CFrame.new(0,10,0) end)
    end
end

if lp then
    if lp.Character then protectCharacter(lp.Character) end
    lp.CharacterAdded:Connect(function(c) task.wait(0.4); protectCharacter(c) end)
end

local cw = workspace:FindFirstChild("Worlds") and workspace.Worlds:FindFirstChild("Christmas World")
k(ws.Camera)
k(workspace:FindFirstChild("Worlds"))
k(cw)
local sp = cw and cw:FindFirstChild("Spawn")
local pp = cw and cw:FindFirstChild("PortalSpawn")
k(sp); k(pp)
local function anc(x)
    while x do k(x) if x==cw then break end x=x.Parent end
end
anc(sp); anc(pp)

local ground = cw and cw:FindFirstChild("Decoration") and cw.Decoration:FindFirstChild("Ground")
local meshes = ground and ground:FindFirstChild("Meshes")
if meshes then
    for _,m in ipairs(meshes:GetDescendants()) do
        if m:IsA("BasePart") then
            k(m)
            pcall(function() m.CanCollide = false end)
        end
    end
end

local surf = Instance.new("Part")
surf.Size = Vector3.new(2000,20,2000)
surf.Position = Vector3.new(0,5,0)
surf.Anchored = true
surf.CanCollide = true
surf.Transparency = 1
surf.Parent = ws

local function isPlayerDesc(o)
    return lp and lp.Character and (o == lp.Character or o:IsDescendantOf(lp.Character))
end

local function safeDestroy(i)
    if not i then return end
    if isPlayerDesc(i) then return end
    if keep[i] then return end
    if i and i.Parent then pcall(function() i:Destroy() end) end
end

local function batch(list, b, w)
    local i=1
    local n=#list
    while i<=n do
        for j=i, math.min(i+b-1, n) do safeDestroy(list[j]) end
        i = i + b
        task.wait(w or 0.25)
    end
end

pcall(function()
    if lp then
        local pg = lp:WaitForChild("PlayerGui",3)
        if pg then
            local t={}
            for _,g in ipairs(pg:GetChildren()) do
                if (g:IsA("ScreenGui") or g:IsA("SurfaceGui") or g:IsA("BillboardGui")) and not isPlayerDesc(g) then table.insert(t,g) end
            end
            batch(t,5,0.4)
        end
    end
end)

do
    local t={}
    for _,o in ipairs(ws:GetDescendants()) do
        if (o:IsA("ScreenGui") or o:IsA("SurfaceGui") or o:IsA("BillboardGui")) and not isPlayerDesc(o) and not keep[o] then table.insert(t,o) end
    end
    batch(t,10,0.3)
end

task.wait(1)

do
    local t={}
    for _,o in ipairs(ws:GetDescendants()) do
        if not keep[o] and not isPlayerDesc(o) then
            if o:IsA("MeshPart") or o:IsA("SpecialMesh") or o:IsA("UnionOperation")
            or o:IsA("Texture") or o:IsA("Decal") or o:IsA("ParticleEmitter")
            or o:IsA("Beam") or o:IsA("Trail") or o:IsA("Fire") or o:IsA("Smoke")
            or o:IsA("Sparkles") or o:IsA("Highlight") or o:IsA("SurfaceAppearance") then
                table.insert(t,o)
            end
        end
    end
    batch(t,40,0.35)
end

task.wait(0.8)

do
    local t={}
    for _,o in ipairs(ws:GetDescendants()) do
        if not keep[o] and not isPlayerDesc(o) then
            if o:IsA("Adornment") or o:IsA("SelectionBox") or o:IsA("SelectionSphere") or o:IsA("ArcHandles") then table.insert(t,o) end
        end
    end
    batch(t,20,0.3)
end

task.wait(0.6)

do
    local t={}
    for _,o in ipairs(ws:GetDescendants()) do
        if not keep[o] and not isPlayerDesc(o) then
            if (o:IsA("Script") or o:IsA("LocalScript") or o:IsA("ModuleScript")) then
                if not o:IsDescendantOf(lp and lp.Character) then table.insert(t,o) end
            end
        end
    end
    batch(t,20,0.6)
end

task.wait(0.8)

do
    local t={}
    for _,o in ipairs(ws:GetDescendants()) do
        if not keep[o] and not isPlayerDesc(o) and not o:IsA("BasePart") then table.insert(t,o) end
    end
    batch(t,30,0.5)
end

task.wait(1)

do
    local t={}
    for _,c in ipairs(ws:GetChildren()) do
        if not keep[c] and not isPlayerDesc(c) then table.insert(t,c) end
    end
    batch(t,3,0.7)
end

task.wait(1)

do
    local t={}
    for _,v in ipairs(Lighting:GetChildren()) do table.insert(t,v) end
    batch(t,8,0.4)
end

task.wait(0.6)

local disableList={
"Chat","VoiceChatService","TextChatService","SoundService","MaterialService","BadgeService",
"BrowserService","CSGDictionaryService","CaptureService","ChangeHistoryService","CollectionService",
"CommerceService","ContextActionService","ControllerService","CookiesService","CreatorStoreService",
"Debris","EditableService","EncodingService","EventIngestService","ExperienceAuthService",
"ExperienceNotificationService","ExperienceService","FaceAnimatorService","FacialAnimationStreamingService",
"GamePassService","GamepadService","GenericChallengeService","GroupService","GuiService",
"GuidRegistryService","HapticService","HeapProfilerService","VRService","AnalyticsService",
"AnimationClipProvider","AppLifeCycleObserverService","AppStorageService","AssetService",
"AudioFocusService","AvatarChatService","AvatarCreationService","AvatarEditorService","AvatarSettings"
}

local temp={}
for i,name in ipairs(disableList) do
    table.insert(temp,name)
    if (#temp>=8) or (i==#disableList) then
        for _,n in ipairs(temp) do
            local ok,svc = pcall(game.GetService,game,n)
            if ok and svc then
                pcall(function() for _,v in ipairs(svc:GetChildren()) do if not isPlayerDesc(v) then pcall(function() v:Destroy() end) end end end)
                pcall(function() svc.Enabled=false end)
            end
        end
        temp={}
        task.wait(0.8)
    end
end

task.wait(0.6)

do
    local t={}
    for _,o in ipairs(ws:GetDescendants()) do
        if not keep[o] and not isPlayerDesc(o) then
            if o:IsA("BillboardGui") or o:IsA("SurfaceGui") or o:IsA("ScreenGui")
            or o:IsA("ParticleEmitter") or o:IsA("Beam") or o:IsA("Trail")
            or o:IsA("Texture") or o:IsA("Decal") or o:IsA("SpecialMesh")
            or o:IsA("MeshPart") or o:IsA("UnionOperation")
            or o:IsA("Fire") or o:IsA("Smoke") or o:IsA("Sparkles")
            or o:IsA("Highlight") or o:IsA("SurfaceAppearance") then table.insert(t,o) end
        end
    end
    batch(t,50,0.4)
end

task.wait(0.6)

pcall(function() RunService:Set3dRenderingEnabled(false) end)
