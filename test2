local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

-- Create UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ChristmasUnlockerUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local Background = Instance.new("Frame")
Background.Name = "Background"
Background.Size = UDim2.new(1, 0, 1, 0)
Background.BackgroundColor3 = Color3.new(0, 0, 0)
Background.BackgroundTransparency = 0.3
Background.BorderSizePixel = 0
Background.Parent = ScreenGui

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0.6, 0, 0.7, 0)
MainFrame.Position = UDim2.new(0.2, 0, 0.15, 0)
MainFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0.15, 0)
Title.BackgroundTransparency = 1
Title.Text = "ðŸŽ„ CHRISTMAS ISLAND UNLOCKER"
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 28
Title.Parent = MainFrame

local UsernameLabel = Instance.new("TextLabel")
UsernameLabel.Name = "UsernameLabel"
Username.Size = UDim2.new(1, 0, 0.1, 0)
Username.Position = UDim2.new(0, 0, 0.15, 0)
Username.BackgroundTransparency = 1
Username.Text = "User: " .. player.Name
Username.TextColor3 = Color3.fromRGB(100, 200, 255)
Username.Font = Enum.Font.Gotham
Username.TextSize = 20
Username.Parent = MainFrame

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, 0, 0.15, 0)
StatusLabel.Position = UDim2.new(0, 0, 0.25, 0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "ðŸ” Checking Christmas World..."
StatusLabel.TextColor3 = Color3.new(1, 1, 1)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 22
StatusLabel.Parent = MainFrame

local ProgressLabel = Instance.new("TextLabel")
ProgressLabel.Name = "ProgressLabel"
ProgressLabel.Size = UDim2.new(1, 0, 0.15, 0)
ProgressLabel.Position = UDim2.new(0, 0, 0.4, 0)
ProgressLabel.BackgroundTransparency = 1
ProgressLabel.Text = "Progress: 0/0 islands"
ProgressLabel.TextColor3 = Color3.new(0.8, 0.8, 0.8)
ProgressLabel.Font = Enum.Font.Gotham
ProgressLabel.TextSize = 20
ProgressLabel.Parent = MainFrame

local UnlockedList = Instance.new("ScrollingFrame")
UnlockedList.Name = "UnlockedList"
UnlockedList.Size = UDim2.new(0.9, 0, 0.35, 0)
UnlockedList.Position = UDim2.new(0.05, 0, 0.55, 0)
UnlockedList.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
UnlockedList.BorderSizePixel = 0
UnlockedList.ScrollBarThickness = 8
UnlockedList.CanvasSize = UDim2.new(0, 0, 0, 0)
UnlockedList.Parent = MainFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 5)
UIListLayout.Parent = UnlockedList

local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0.2, 0, 0.1, 0)
CloseButton.Position = UDim2.new(0.4, 0, 0.92, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.Text = "CLOSE"
CloseButton.TextColor3 = Color3.new(1, 1, 1)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 18
CloseButton.Parent = MainFrame

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Update UI function
local function updateStatus(text, color)
    StatusLabel.Text = text
    StatusLabel.TextColor3 = color or Color3.new(1, 1, 1)
end

local function updateProgress(current, total)
    ProgressLabel.Text = string.format("Progress: %d/%d islands", current, total)
end

local function addUnlockedIsland(islandName)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 30)
    frame.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    frame.BorderSizePixel = 0
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = "âœ… " .. islandName
    label.TextColor3 = Color3.fromRGB(100, 255, 100)
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    frame.Parent = UnlockedList
    UnlockedList.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
end

-- Main script logic
local function main()
    updateStatus("ðŸ” Checking Christmas World...", Color3.new(1, 1, 1))
    
    local christmasWorld = workspace.Worlds:FindFirstChild("Christmas World")
    if not christmasWorld then
        updateStatus("âŒ Christmas World not found", Color3.fromRGB(255, 50, 50))
        return false
    end
    
    local islandsFolder = christmasWorld:FindFirstChild("Islands")
    if not islandsFolder then
        updateStatus("âŒ Islands folder not found", Color3.fromRGB(255, 50, 50))
        return false
    end
    
    if not firetouchinterest then
        updateStatus("âŒ firetouchinterest not available", Color3.fromRGB(255, 50, 50))
        return false
    end
    
    -- Check if world is unlocked
    local data = LocalData:Get()
    local worldUnlocked = false
    
    if data then
        if data.WorldsUnlocked and data.WorldsUnlocked["Christmas World"] then
            worldUnlocked = true
        elseif data.UnlockedWorlds and data.UnlockedWorlds["Christmas World"] then
            worldUnlocked = true
        elseif data.Worlds and data.Worlds["Christmas World"] then
            worldUnlocked = true
        end
    end
    
    if not worldUnlocked then
        updateStatus("âŒ Christmas World is not unlocked", Color3.fromRGB(255, 100, 100))
        return false
    end
    
    updateStatus("âœ… Christmas World is unlocked", Color3.fromRGB(100, 255, 100))
    
    -- Get island names
    local allIslandNames = {}
    for _, isl in ipairs(islandsFolder:GetChildren()) do
        table.insert(allIslandNames, isl.Name)
    end
    
    local totalIslands = #allIslandNames
    updateProgress(0, totalIslands)
    
    -- Collect parts
    local parts = {}
    for _, isl in ipairs(islandsFolder:GetChildren()) do
        local island = isl:FindFirstChild("Island")
        if island then
            for _, obj in ipairs(island:GetDescendants()) do
                if obj:IsA("BasePart") then
                    table.insert(parts, obj)
                end
            end
        end
    end
    
    updateStatus(string.format("ðŸ”„ Touching %d parts...", #parts), Color3.fromRGB(255, 200, 50))
    
    -- Main loop
    local checkCounter = 0
    local unlockedIslands = {}
    
    task.spawn(function()
        while ScreenGui.Parent do
            checkCounter += 1
            
            if checkCounter >= 20 then
                checkCounter = 0
                
                local unlocked = data and data.AreasUnlocked or {}
                local unlockedCount = 0
                
                for i = 1, totalIslands do
                    local islandName = allIslandNames[i]
                    if unlocked[islandName] and not unlockedIslands[islandName] then
                        unlockedCount += 1
                        unlockedIslands[islandName] = true
                        addUnlockedIsland(islandName)
                    elseif unlocked[islandName] then
                        unlockedCount += 1
                    end
                end
                
                updateProgress(unlockedCount, totalIslands)
                
                if unlockedCount >= totalIslands then
                    updateStatus("ðŸŽ‰ ALL ISLANDS UNLOCKED!", Color3.fromRGB(100, 255, 100))
                    break
                end
            end
            
            -- Touch all parts
            for i = 1, #parts do
                local part = parts[i]
                if part and part:IsDescendantOf(workspace) then
                    firetouchinterest(hrp, part, 0)
                    firetouchinterest(hrp, part, 1)
                end
            end
            
            task.wait()
        end
    end)
    
    return true
end

-- Start the script
main()
