local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local ws = workspace

local lp = Players.LocalPlayer
local char = lp and lp.Character

local worlds = ws:FindFirstChild("Worlds")
local cw = worlds and worlds:FindFirstChild("Christmas World")

local keep = {}
local function k(x) if x then keep[x] = true end end

k(ws.Camera)
k(worlds)
k(cw)
k(char)
k(cw and cw:FindFirstChild("Spawn"))
k(cw and cw:FindFirstChild("PortalSpawn"))

local function anc(x)
    while x do
        keep[x] = true
        if x == cw then break end
        x = x.Parent
    end
end

if cw and cw:FindFirstChild("Spawn") then anc(cw.Spawn) end
if cw and cw:FindFirstChild("PortalSpawn") then anc(cw.PortalSpawn) end

local surf = Instance.new("Part")
surf.Size = Vector3.new(2000,20,2000)
surf.Position = Vector3.new(0,5,0)
surf.Anchored = true
surf.CanCollide = true
surf.Transparency = 1
surf.Name = "SpawnSurface"
surf.Parent = ws

if lp then
    lp.CharacterAdded:Connect(function(c)
        task.wait(0.5)
        local hrp = c:WaitForChild("HumanoidRootPart")
        hrp.CFrame = CFrame.new(0,10,0)
    end)
    if char then
        task.wait(0.5)
        local ok,hrp = pcall(function() return char:WaitForChild("HumanoidRootPart",3) end)
        if ok and hrp then hrp.CFrame = CFrame.new(0,10,0) end
    end
end

local function safeDestroy(inst)
    if inst and inst.Parent then
        pcall(function() inst:Destroy() end)
    end
end

local function batchDestroy(list, batchSize, waitTime)
    local i = 1
    local total = #list
    while i <= total do
        for j = i, math.min(i + batchSize - 1, total) do
            safeDestroy(list[j])
        end
        i = i + batchSize
        task.wait(waitTime or 0.25)
    end
end

pcall(function()
    if lp then
        local pg = lp:WaitForChild("PlayerGui",3)
        if pg then
            local sgs = {}
            for _, g in ipairs(pg:GetChildren()) do
                if g:IsA("ScreenGui") or g:IsA("SurfaceGui") or g:IsA("BillboardGui") then
                    table.insert(sgs, g)
                end
            end
            batchDestroy(sgs, 5, 0.4)
        end
    end
end)

do
    local guis = {}
    for _, d in ipairs(ws:GetDescendants()) do
        if d:IsA("ScreenGui") or d:IsA("SurfaceGui") or d:IsA("BillboardGui") then
            if not keep[d] then table.insert(guis, d) end
        end
    end
    batchDestroy(guis, 10, 0.3)
end

task.wait(1)

do
    local visuals = {}
    for _, d in ipairs(ws:GetDescendants()) do
        if not keep[d] then
            if d:IsA("MeshPart")
            or d:IsA("SpecialMesh")
            or d:IsA("UnionOperation")
            or d:IsA("Texture")
            or d:IsA("Decal")
            or d:IsA("ParticleEmitter")
            or d:IsA("Beam")
            or d:IsA("Trail")
            or d:IsA("Fire")
            or d:IsA("Smoke")
            or d:IsA("Sparkles")
            or d:IsA("Highlight")
            or d:IsA("SurfaceAppearance")
            then
                table.insert(visuals, d)
            end
        end
    end
    batchDestroy(visuals, 40, 0.35)
end

task.wait(0.8)

do
    local renderAdj = {}
    for _, d in ipairs(ws:GetDescendants()) do
        if not keep[d] then
            if d:IsA("Adornment") or d:IsA("SelectionBox") or d:IsA("SelectionSphere") or d:IsA("ArcHandles") then
                table.insert(renderAdj, d)
            end
        end
    end
    batchDestroy(renderAdj, 20, 0.3)
end

task.wait(0.6)

do
    local scripts = {}
    for _, d in ipairs(ws:GetDescendants()) do
        if not keep[d] then
            if d:IsA("Script") or d:IsA("LocalScript") or d:IsA("ModuleScript") then
                if not d:IsDescendantOf(char) then
                    table.insert(scripts, d)
                end
            end
        end
    end
    batchDestroy(scripts, 20, 0.6)
end

task.wait(0.8)

do
    local others = {}
    for _, o in ipairs(ws:GetDescendants()) do
        if not keep[o] then
            if not o:IsA("BasePart") then
                table.insert(others, o)
            end
        end
    end
    batchDestroy(others, 30, 0.5)
end

task.wait(1)

do
    local tops = {}
    for _, c in ipairs(ws:GetChildren()) do
        if not keep[c] then table.insert(tops, c) end
    end
    batchDestroy(tops, 3, 0.7)
end

task.wait(1)

do
    local items = {}
    for _, v in ipairs(Lighting:GetChildren()) do table.insert(items, v) end
    batchDestroy(items, 8, 0.4)
    pcall(function()
        Lighting.Brightness = 0
        Lighting.GlobalShadows = false
        Lighting.Ambient = Color3.new(0,0,0)
        Lighting.OutdoorAmbient = Color3.new(0,0,0)
    end)
end

task.wait(0.6)

local disableList = {
"Chat","VoiceChatService","TextChatService","SoundService","MaterialService","BadgeService",
"BrowserService","CSGDictionaryService","CaptureService","ChangeHistoryService","CollectionService",
"CommerceService","ContextActionService","ControllerService","CookiesService","CreatorStoreService",
"Debris","EditableService","EncodingService","EventIngestService","ExperienceAuthService",
"ExperienceNotificationService","ExperienceService","FaceAnimatorService","FacialAnimationStreamingService",
"GamePassService","GamepadService","GenericChallengeService","GroupService","GuiService",
"GuidRegistryService","HapticService","HeapProfilerService","VRService","AnalyticsService",
"AnimationClipProvider","AppLifeCycleObserverService","AppStorageService","AssetService",
"AudioFocusService","AvatarChatService","AvatarCreationService","AvatarEditorService","AvatarSettings"
}

local batch = {}
for i, name in ipairs(disableList) do
    table.insert(batch, name)
    if (#batch >= 8) or (i == #disableList) then
        for _, sname in ipairs(batch) do
            local ok, svc = pcall(game.GetService, game, sname)
            if ok and svc then
                pcall(function()
                    for _, v in ipairs(svc:GetChildren()) do
                        pcall(function() v:Destroy() end)
                    end
                end)
                pcall(function() svc.Enabled = false end)
            end
        end
        batch = {}
        task.wait(0.8)
    end
end

task.wait(0.6)

do
    local final = {}
    for _, d in ipairs(ws:GetDescendants()) do
        if not keep[d] then
            if d:IsA("BillboardGui") or d:IsA("SurfaceGui") or d:IsA("ScreenGui")
            or d:IsA("ParticleEmitter") or d:IsA("Beam") or d:IsA("Trail")
            or d:IsA("Texture") or d:IsA("Decal") or d:IsA("SpecialMesh")
            or d:IsA("MeshPart") or d:IsA("UnionOperation")
            or d:IsA("Fire") or d:IsA("Smoke") or d:IsA("Sparkles")
            or d:IsA("Highlight") or d:IsA("SurfaceAppearance") then
                table.insert(final, d)
            end
        end
    end
    batchDestroy(final, 50, 0.4)
end

task.wait(0.6)

pcall(function() RunService:Set3dRenderingEnabled(false) end)
