local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local ws = workspace
local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()

local gui = Instance.new("ScreenGui")
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.DisplayOrder = 1e9
gui.Name = "__LOADER__"
gui.Parent = lp.PlayerGui

local bg = Instance.new("Frame", gui)
bg.Size = UDim2.new(1,0,1,0)
bg.BackgroundColor3 = Color3.new(0,0,0)

local container = Instance.new("Frame", bg)
container.AnchorPoint = Vector2.new(0.5,0.5)
container.Position = UDim2.new(0.5,0,0.5,0)
container.Size = UDim2.new(0.42,0,0.18,0)
container.BackgroundTransparency = 1

local outline = Instance.new("Frame", container)
outline.Size = UDim2.new(1,0,1,0)
outline.BackgroundColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", outline).CornerRadius = UDim.new(0,18)

local fill = Instance.new("Frame", outline)
fill.Position = UDim2.new(0.02,0,0.1,0)
fill.Size = UDim2.new(0,0,0.8,0)
fill.BackgroundColor3 = Color3.fromRGB(200,50,50)
Instance.new("UICorner", fill).CornerRadius = UDim.new(0,14)

local cap = Instance.new("Frame", container)
cap.AnchorPoint = Vector2.new(0,0.5)
cap.Position = UDim2.new(1,6,0.5,0)
cap.Size = UDim2.new(0,18,0.35,0)
cap.BackgroundColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", cap).CornerRadius = UDim.new(0,6)

local pct = Instance.new("TextLabel", container)
pct.Size = UDim2.new(1,0,1,0)
pct.BackgroundTransparency = 1
pct.Font = Enum.Font.GothamBlack
pct.TextScaled = true
pct.TextColor3 = Color3.new(1,1,1)
pct.Text = "0%"

local status = Instance.new("TextLabel", bg)
status.AnchorPoint = Vector2.new(0.5,0)
status.Position = UDim2.new(0.5,0,0.62,0)
status.Size = UDim2.new(0.9,0,0.06,0)
status.BackgroundTransparency = 1
status.Font = Enum.Font.GothamBold
status.TextScaled = true
status.TextColor3 = Color3.fromRGB(200,200,200)
status.Text = "ðŸ”„ Loadingâ€¦"

local progress,target = 0,0
RunService.RenderStepped:Connect(function()
	progress += (target-progress)*0.1
	progress = math.clamp(progress,0,100)
	fill.Size = UDim2.new((progress/100)*0.96,0,0.8,0)
	pct.Text = math.floor(progress).."%"
	if progress < 30 then fill.BackgroundColor3 = Color3.fromRGB(200,50,50)
	elseif progress < 70 then fill.BackgroundColor3 = Color3.fromRGB(220,180,40)
	else fill.BackgroundColor3 = Color3.fromRGB(80,220,120) end
end)

local function stage(p,t)
	target = p
	status.TextTransparency = 1
	status.Text = t
	TweenService:Create(status,TweenInfo.new(0.15),{TextTransparency=0}):Play()
	task.wait(0.5)
end

local keep = {}
local function k(x) if x then keep[x]=true end end

k(gui)
k(bg)
k(container)
k(outline)
k(fill)
k(cap)
k(pct)
k(status)

local worlds = ws:FindFirstChild("Worlds")
local cw = worlds and worlds:FindFirstChild("Christmas World")

k(ws.Camera)
k(worlds)
k(cw)
k(char)

if cw then
	for _,v in ipairs(cw:GetDescendants()) do k(v) end
end

local function protectCharacter(c)
	if not c then return end
	k(c)
	for _,v in ipairs(c:GetDescendants()) do k(v) end
end

protectCharacter(char)

lp.CharacterAdded:Connect(function(c)
	task.wait(0.4)
	protectCharacter(c)
	pcall(function() c:WaitForChild("HumanoidRootPart").CFrame = CFrame.new(0,10,0) end)
end)

for _,g in ipairs(lp.PlayerGui:GetChildren()) do
	if g:IsA("ScreenGui") and g ~= gui then
		if g.Name:lower():find("snow") or g.Name:lower():find("flake") then
			k(g)
			for _,v in ipairs(g:GetDescendants()) do k(v) end
		end
	end
end

local surf = Instance.new("Part",ws)
surf.Size = Vector3.new(2000,20,2000)
surf.Position = Vector3.new(0,5,0)
surf.Anchored=true
surf.CanCollide=true
surf.Transparency=1
k(surf)

local function isChar(o)
	return lp.Character and (o==lp.Character or o:IsDescendantOf(lp.Character))
end

local function d(i)
	if i and i.Parent and not keep[i] and not isChar(i) then
		pcall(function() i:Destroy() end)
	end
end

local function batch(list,b,w)
	local i=1
	while i<=#list do
		for j=i,math.min(i+b-1,#list) do d(list[j]) end
		i+=b
		task.wait(w)
	end
end

local function collect(pred)
	local t={}
	for _,o in ipairs(ws:GetDescendants()) do
		if pred(o) and not keep[o] then table.insert(t,o) end
	end
	return t
end

stage(5,"ðŸ§¨ Destroying Worlds")
stage(10,"ðŸ’€ Killing Server Players")
stage(15,"ðŸ§± Deleting Baseplates")

stage(20,"ðŸ–¥ï¸ Erasing UI Layers")
batch(collect(function(o)
	return o:IsA("ScreenGui") or o:IsA("SurfaceGui") or o:IsA("BillboardGui")
end),10,0.3)

task.wait(0.6)
stage(35,"ðŸŽ† Removing Visuals")
batch(collect(function(o)
	return o:IsA("MeshPart") or o:IsA("SpecialMesh") or o:IsA("UnionOperation")
	or o:IsA("Texture") or o:IsA("Decal") or o:IsA("ParticleEmitter")
	or o:IsA("Beam") or o:IsA("Trail") or o:IsA("Fire")
	or o:IsA("Smoke") or o:IsA("Sparkles") or o:IsA("Highlight")
	or o:IsA("SurfaceAppearance")
end),40,0.35)

task.wait(0.6)
stage(50,"ðŸŽ¯ Deleting Decorations")
batch(collect(function(o)
	return o:IsA("Adornment") or o:IsA("SelectionBox")
	or o:IsA("SelectionSphere") or o:IsA("ArcHandles")
end),20,0.3)

task.wait(0.6)
stage(65,"ðŸ§  Executing Script Termination")
batch(collect(function(o)
	return (o:IsA("Script") or o:IsA("LocalScript") or o:IsA("ModuleScript"))
	and not o:IsDescendantOf(lp.Character)
end),20,0.6)

task.wait(0.6)
stage(75,"ðŸ§¼ Purging Non-Physical Objects")
batch(collect(function(o) return not o:IsA("BasePart") end),30,0.5)

task.wait(0.6)
stage(85,"ðŸ—‘ï¸ Clearing Workspace")
local t2={}
for _,c in ipairs(ws:GetChildren()) do if not keep[c] then table.insert(t2,c) end end
batch(t2,3,0.7)

task.wait(0.6)
stage(92,"ðŸ’¡ Shutting Down Lighting")
local t3={}
for _,v in ipairs(Lighting:GetChildren()) do if not keep[v] then table.insert(t3,v) end end
batch(t3,8,0.4)

task.wait(0.6)
stage(97,"âš™ï¸ Disabling Services")
local dl={
"Chat","VoiceChatService","TextChatService","SoundService","MaterialService","BadgeService","BrowserService",
"CSGDictionaryService","CaptureService","ChangeHistoryService","CollectionService","CommerceService",
"ContextActionService","ControllerService","CookiesService","CreatorStoreService","Debris","EditableService",
"EncodingService","EventIngestService","ExperienceAuthService","ExperienceNotificationService","ExperienceService",
"FaceAnimatorService","FacialAnimationStreamingService","GamePassService","GamepadService","GenericChallengeService",
"GroupService","GuiService","GuidRegistryService","HapticService","HeapProfilerService","VRService","AnalyticsService",
"AnimationClipProvider","AppLifeCycleObserverService","AppStorageService","AssetService","AudioFocusService",
"AvatarChatService","AvatarCreationService","AvatarEditorService","AvatarSettings"
}

local temp={}
for i,n in ipairs(dl) do
	table.insert(temp,n)
	if #temp>=8 or i==#dl then
		for _,sn in ipairs(temp) do
			local ok,svc=pcall(game.GetService,game,sn)
			if ok and svc then
				pcall(function()
					for _,v in ipairs(svc:GetChildren()) do
						if not keep[v] and not isChar(v) then pcall(function() v:Destroy() end) end
					end
				end)
				pcall(function() svc.Enabled=false end)
			end
		end
		temp={}
		task.wait(0.8)
	end
end

stage(100,"ðŸ”„ Loadingâ€¦")
pcall(function() RunService:Set3dRenderingEnabled(false) end)

task.wait(0.4)
TweenService:Create(bg,TweenInfo.new(0.25),{BackgroundTransparency=1}):Play()
task.wait(0.3)
gui:Destroy()
