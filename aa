local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

local gui = Instance.new("ScreenGui")
gui.Name = "ValentineAuctionUI"
gui.Parent = PlayerGui
gui.ResetOnSpawn = false

local background = Instance.new("Frame")
background.Size = UDim2.fromScale(1,1)
background.BackgroundColor3 = Color3.fromRGB(0,0,0)
background.BackgroundTransparency = 0.5
background.Parent = gui

local highlight = Instance.new("Frame")
highlight.Size = UDim2.fromScale(1,1)
highlight.Position = UDim2.new(0,0,0,0)
highlight.BackgroundTransparency = 1
highlight.BorderSizePixel = 4
highlight.BorderColor3 = Color3.fromRGB(255,255,255)
highlight.Parent = gui

local container = Instance.new("Frame")
container.Size = UDim2.fromScale(0.6,0.78)
container.Position = UDim2.fromScale(0.2,0.1)
container.BackgroundTransparency = 1
container.Parent = background

local userLabel = Instance.new("TextLabel")
userLabel.Size = UDim2.new(1,0,0,50)
userLabel.Position = UDim2.new(0,0,0,0)
userLabel.BackgroundTransparency = 1
userLabel.Text = "ðŸ‘¤ "..player.Name
userLabel.TextScaled = true
userLabel.Font = Enum.Font.GothamBold
userLabel.TextColor3 = Color3.fromRGB(255,255,255)
userLabel.Parent = container

local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1,0,1,-60)
contentFrame.Position = UDim2.new(0,0,0,50)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = container

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0,12)
layout.Parent = contentFrame

local heartsLabel = Instance.new("TextLabel")
heartsLabel.Size = UDim2.new(1,0,0,40)
heartsLabel.BackgroundTransparency = 1
heartsLabel.TextScaled = true
heartsLabel.Font = Enum.Font.GothamBold
heartsLabel.TextColor3 = Color3.fromRGB(255,255,255)
heartsLabel.Parent = contentFrame

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1,0,0,35)
statusLabel.BackgroundTransparency = 1
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextColor3 = Color3.fromRGB(255,255,255)
statusLabel.Text = "ðŸ•“ Idle"
statusLabel.Parent = contentFrame

local valentineCount = 0
local cashEarned = 0
local auctionStep = "Idle"

local function updateUI()
    heartsLabel.Text = "ðŸ’˜ Valentines: "..valentineCount.." | ðŸ’¸ Cash: "..cashEarned
    if auctionStep == "Found" then
        highlight.BorderColor3 = Color3.fromRGB(0,255,0)
    elseif auctionStep == "Scanning" or auctionStep == "Bidding" then
        highlight.BorderColor3 = Color3.fromRGB(255,255,0)
    elseif auctionStep == "Idle" then
        highlight.BorderColor3 = Color3.fromRGB(255,255,255)
    elseif auctionStep == "Full" then
        highlight.BorderColor3 = Color3.fromRGB(255,0,0)
    end
    statusLabel.Text = auctionStep
end

task.spawn(function()
    while true do
        updateUI()
        task.wait(0.5)
    end
end)

local AuctionsFolder = workspace:WaitForChild("Debris"):WaitForChild("Auctions")
local ItemsModule = require(ReplicatedStorage.Modules.Items)
local Auctions = ReplicatedStorage:WaitForChild("Events"):WaitForChild("Auctions")
local EnterQueue = Auctions:WaitForChild("EnterQueue")
local Skip = Auctions:WaitForChild("Skip")
local SkipCountdown = Auctions:WaitForChild("SkipCountdown")
local UpdateCurrentBid = Auctions:WaitForChild("UpdateCurrentBid")
local PlaceBid = Auctions:WaitForChild("PlaceBid")

local currentNextBid
local currentBidder
local foundValentine = false
local inAuction = false

UpdateCurrentBid.OnClientEvent:Connect(function(data)
    if not data then return end
    currentNextBid = data.nextBid
    currentBidder = data.player
end)

AuctionsFolder.ChildAdded:Connect(function() inAuction = true end)
AuctionsFolder.ChildRemoved:Connect(function() if #AuctionsFolder:GetChildren() == 0 then inAuction = false end end)

task.spawn(function()
    while true do
        auctionStep = "Joining Auction Queue"
        pcall(function() EnterQueue:InvokeServer("1") end)
        repeat task.wait(0.5) until inAuction
        auctionStep = "Scanning"
        while inAuction and not foundValentine do
            local garages = AuctionsFolder:GetChildren()
            for _, garage in ipairs(garages) do
                local itemsFolder = garage:FindFirstChild("Items")
                local hasValentine = false
                if itemsFolder then
                    for _, itemInstance in pairs(itemsFolder:GetChildren()) do
                        local itemData = ItemsModule[itemInstance.Name]
                        if itemData and string.find(string.lower(itemData.Name),"valentine") then
                            foundValentine = true
                            hasValentine = true
                            break
                        end
                    end
                end
                if not hasValentine then
                    pcall(function() SkipCountdown:InvokeServer() end)
                    task.wait(0.05)
                    pcall(function() Skip:InvokeServer() end)
                end
                if foundValentine then break end
            end
            task.wait(0.5)
        end
        repeat task.wait(1) until not inAuction
        if foundValentine then auctionStep = "Found" end
        task.wait(0.5)
    end
end)

task.spawn(function()
    while true do
        task.wait(0.3)
        if inAuction and currentNextBid and currentBidder ~= player and not foundValentine then
            auctionStep = "Bidding"
            pcall(function() PlaceBid:InvokeServer(currentNextBid) end)
        end
    end
end)

local function clickOkButton()
    local function tryClick(obj)
        pcall(function() obj:Activate() end)
        if getconnections then
            for _,v in pairs(getconnections(obj.MouseButton1Click)) do
                pcall(function() v:Fire() end)
            end
        end
    end
    local function checkForButton()
        local itemsWon = PlayerGui:FindFirstChild("ItemsWon",true)
        if itemsWon then
            local button = itemsWon:FindFirstChild("Button",true)
            if button then tryClick(button) end
        end
    end
    checkForButton()
    PlayerGui.DescendantAdded:Connect(function(obj)
        if obj.Name == "Button" then
            task.wait()
            tryClick(obj)
        end
    end)
    task.spawn(function()
        while true do
            task.wait(0.5)
            checkForButton()
        end
    end)
end

clickOkButton()
