local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")

local Network = require(ReplicatedStorage.Modules.Network)

-- Anti-idle
pcall(function()
	for _, x in pairs(getconnections(Players.LocalPlayer.Idled)) do
		x:Disable()
	end
end)

-- UI: Copy JobId button
local function makeCopyJobIdUI()
	-- prevent duplicates
	pcall(function()
		local old = CoreGui:FindFirstChild("CopyJobIdUI")
		if old then old:Destroy() end
	end)

	local sg = Instance.new("ScreenGui")
	sg.Name = "CopyJobIdUI"
	sg.ResetOnSpawn = false
	sg.Parent = CoreGui

	local btn = Instance.new("TextButton")
	btn.Name = "CopyJobId"
	btn.Size = UDim2.new(0, 170, 0, 38)
	btn.Position = UDim2.new(0, 12, 0.5, -19)
	btn.Text = "Copy JobId"
	btn.BackgroundTransparency = 0.15
	btn.Parent = sg

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 10)
	corner.Parent = btn

	btn.MouseButton1Click:Connect(function()
		local job = game.JobId
		pcall(function()
			setclipboard(job)
		end)
		btn.Text = "Copied!"
		task.delay(1.2, function()
			if btn and btn.Parent then
				btn.Text = "Copy JobId"
			end
		end)
	end)
end

makeCopyJobIdUI()

local inTrade = false

Network:BindEvents({
	-- Auto accept all incoming trade requests
	TradeRequest = function(sender)
		Network:FireServer("AcceptTrade", sender)
	end,

	-- Trade state detection
	StartTrade = function(_tradeData)
		inTrade = true
	end,

	CloseTrade = function()
		inTrade = false
	end,
})

-- While in trade: every 20 seconds, ready up once (repeats if still in trade)
task.spawn(function()
	while true do
		while not inTrade do
			task.wait(0.2)
		end

		while inTrade do
			task.wait(20)
			if inTrade then
				Network:FireServer("ReadyUp", false, true)
			end
		end
	end
end)

-- Status print every 1 second
while true do
	print("In trade status =", inTrade)
	task.wait(1)
end
