local RS = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Replication = require(RS.Game.Replication)
local Signal = require(RS.Modules.Signal)

local LP = Players.LocalPlayer
local PG = LP:WaitForChild("PlayerGui")

getgenv().AutoSellConfig = {
    Enabled = true,
    ScanInterval = 1.5,
    MaxListings = 12,
    Pets = {
        ["Surge Dragon"] = 75,
        ["Dual Shock"] = 225
    }
}

local listed = {}
local busy = false

local function openUI()
    Signal.Fire("OpenMenu","BoothListing")
end

local function getUI()
    return PG:FindFirstChild("BoothListing", true)
end

local function fillAndConfirm(price)
    local ui = getUI()
    if not ui then return end
    local box = ui:FindFirstChild("Price", true) or ui:FindFirstChild("Amount", true)
    local btn = ui:FindFirstChild("Confirm", true) or ui:FindFirstChild("List", true)
    if box and btn then
        box.Text = tostring(price)
        task.wait()
        btn:Activate()
    end
end

local function autoList()
    if busy or not getgenv().AutoSellConfig.Enabled then return end
    busy = true
    openUI()
    task.wait(0.2)

    for petId, pet in pairs(Replication.Data.Pets or {}) do
        local name = pet.Nickname or pet.Name
        local price = getgenv().AutoSellConfig.Pets[name]
        if price and not listed[petId] then
            print("[AUTO SELL] LISTING:", name, price)
            Signal.Fire("PromptListBooth", petId)
            task.wait(0.15)
            fillAndConfirm(price)
            listed[petId] = true
            task.wait(0.4)
        end
    end
    busy = false
end

task.spawn(function()
    while true do
        pcall(autoList)
        task.wait(getgenv().AutoSellConfig.ScanInterval)
    end
end)
