task.wait(math.random(1,60))

local httpRequest =
    (syn and syn.request) or
    (http and http.request) or
    (http_request) or
    (fluxus and fluxus.request) or
    (request)

if not httpRequest then return end

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)
local PetsModule = require(ReplicatedStorage.Shared.Data.Pets)

local player = Players.LocalPlayer
local detectorName = player and player.Name or "Unknown"

local WEBHOOKS = {
    "https://discord.com/api/webhooks/1454576467529699539/kKALub_3NXpXKV6o1zElqkFzfAagWA1NdRt8H2XmLGdLv0DH9po0xoXi1HNQe3btuDvf",
    "https://discord.com/api/webhooks/1454576475167789138/O6uK3FYmQxQmI86s7-xMap4DccNbKGwGweqjX9aE9khUjKMcnDiSOVHbYlUrrtgbln-4",
    "https://discord.com/api/webhooks/1451636124324728873/x-6Yl_dwHXiaRPe6_6uvg7_z3Aj3bbi2dZs-aqftmQfmCo-Fyd-_thY7j0TePvkRfPlt"
}

local IGNORE = {
    ["Frosted Luminosity"] = true,
    ["Radiant Soul"] = true
}

local function petImageFromName(name)
    local slug = name:lower():gsub("%s+", "_")
    return "https://content.bgsi.io/" .. slug .. ".webp"
end

local data = LocalData:Get()
if not data or not data.Pets then return end

local detected = {}
local thumbnail

for _, pet in pairs(data.Pets) do
    if pet.XL and not IGNORE[pet.Name] then
        local info = PetsModule[pet.Name]
        if info and info.Rarity == "Secret" then
            local name = "XL " .. pet.Name

            if pet.Shiny and pet.Mythic then
                name = name .. " (Shiny Mythic)"
            elseif pet.Shiny then
                name = name .. " (Shiny)"
            elseif pet.Mythic then
                name = name .. " (Mythic)"
            end

            table.insert(detected, name)
            thumbnail = thumbnail or petImageFromName(pet.Name)
        end
    end
end

if #detected == 0 then return end

local payload = {
    username = "BGSI Pet Detector",
    embeds = {{
        title = "XL Secret Detected!",
        color = 15761628,
        thumbnail = { url = thumbnail },
        fields = {
            {
                name = "Pets",
                value = table.concat(detected, "\n"),
                inline = false
            },
            {
                name = "Detected By",
                value = detectorName,
                inline = true
            }
        }
    }}
}

httpRequest({
    Url = WEBHOOKS[math.random(#WEBHOOKS)],
    Method = "POST",
    Headers = { ["Content-Type"] = "application/json" },
    Body = HttpService:JSONEncode(payload)
})
