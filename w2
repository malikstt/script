-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- Constants
local WORLD_NAME = "Seven Seas"
local MAX_ATTEMPTS = 5
local RETRY_DELAY = 2

-- LocalData
local LocalData = require(
    ReplicatedStorage
        :WaitForChild("Client")
        :WaitForChild("Framework")
        :WaitForChild("Services")
        :WaitForChild("LocalData")
)

-- RemoteEvent
local RemoteEvent = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")
    :WaitForChild("RemoteEvent")

-- UI creation
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "WorldStatusGui"
screenGui.ResetOnSpawn = false
screenGui.Enabled = false
screenGui.Parent = PlayerGui

local background = Instance.new("Frame")
background.Size = UDim2.new(1, 0, 1, 0)
background.Position = UDim2.new(0, 0, 0, 0)
background.BorderSizePixel = 0
background.Parent = screenGui

local textLabel = Instance.new("TextLabel")
textLabel.Size = UDim2.new(1, 0, 0.2, 0)
textLabel.Position = UDim2.new(0, 0, 0.4, 0)
textLabel.BackgroundTransparency = 1
textLabel.Font = Enum.Font.GothamBold
textLabel.TextScaled = true
textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
textLabel.Parent = background

-- Helpers
local function isWorldUnlocked()
    local data = LocalData:Get()
    if not data or not data.WorldsUnlocked then
        return false
    end
    return data.WorldsUnlocked[WORLD_NAME] == true
end

local function fireUnlockRemote()
    RemoteEvent:FireServer("UnlockWorld", WORLD_NAME)
end

local function showScreen(color, text)
    background.BackgroundColor3 = color
    textLabel.Text = text
    screenGui.Enabled = true
end

-- Main logic
task.spawn(function()
    -- If already unlocked, do nothing except display success
    if isWorldUnlocked() then
        showScreen(Color3.fromRGB(0, 170, 0), "W3 IS UNLOCKED")
        return
    end

    -- Try unlocking up to MAX_ATTEMPTS
    for attempt = 1, MAX_ATTEMPTS do
        fireUnlockRemote()
        task.wait(RETRY_DELAY)

        if isWorldUnlocked() then
            showScreen(Color3.fromRGB(0, 170, 0), "W3 IS UNLOCKED")
            return
        end
    end

    -- Failed after all attempts
    showScreen(Color3.fromRGB(170, 0, 0), "W3 IS NOT UNLOCKED")
end)
