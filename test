local function handleAuctionEnd()
	coroutine.wrap(function()
		local timeout = 30
		local start = tick()
		local handled = false
		
		while not handled and tick() - start < timeout do
			local gui = LocalPlayer:FindFirstChild("PlayerGui") and 
					   LocalPlayer.PlayerGui:FindFirstChild("ItemsWon", true)
			
			if gui then
				-- Check for NoItems GUI (won nothing)
				local noItems = gui:FindFirstChild("NoItems", true)
				if noItems and noItems.Visible then
					print("ðŸ“¦ No items won - closing")
					local okButton = noItems:FindFirstChild("Button", true)
					if okButton then
						clickButton(okButton)
					else
						gui:Destroy()
					end
					handled = true
					auctionEnded = true
					break
				end
				
				-- Check for ItemsFrame (won items)
				local itemsFrame = gui:FindFirstChild("ItemsFrame", true)
				if itemsFrame and itemsFrame.Visible then
					print("ðŸŽ Items won GUI detected")
					
					-- Wait for items to load
					taskWait(0.5)
					
					local frame = itemsFrame:FindFirstChild("Frame")
					if frame then
						local targetGuid = nil
						local targetButton = nil
						
						-- First, get the GUID of our target item from the auction results
						-- You need to capture this during the auction or from the GUI
						-- The item buttons in ItemsWon have the GUID stored somewhere
						
						for _, child in pairs(frame:GetChildren()) do
							if child:IsA("ImageButton") then
								-- Check if this is our target by looking at the model
								local viewport = child:FindFirstChild("ViewportFrame")
								if viewport then
									local model = viewport:FindFirstChildWhichIsA("Model")
									if model and model.Name == targetItemName then
										print("ðŸŽ¯ Found target item button")
										targetButton = child
										
										-- Toggle the checkmark (select the item)
										local check = child:FindFirstChild("Check")
										if check then
											print("âœ… Selecting item")
											check.Visible = true
											-- The module also adds to a table, but we can't access that here
											-- The check visibility is what matters for the UI
										end
										break
									end
								end
							end
						end
						
						-- Wait a moment for selection to register
						taskWait(0.3)
						
						-- Click Confirm
						local confirm = itemsFrame:FindFirstChild("ConfirmButton", true)
						if confirm then
							print("âœ… Clicking Confirm")
							clickButton(confirm)
							obtainedTarget = true
							handled = true
							taskWait(1)
							
							-- Now handle selling other items if needed
							if obtainedTarget then
								taskWait(0.5)
								-- Look for SellItems GUI that appears after confirming
								local sellGui = LocalPlayer.PlayerGui:FindFirstChild("SellItems")
								if sellGui and sellGui.Visible then
									print("ðŸ’° Selling other items")
									-- Click the sell button for remaining items
									local sellButton = sellGui:FindFirstChild("Frame") and 
													   sellGui.Frame:FindFirstChild("Normal") or
													   sellGui:FindFirstChild("Normal", true)
									if sellButton then
										clickButton(sellButton)
									end
								end
							end
						end
					end
				end
			end
			taskWait(0.3)
		end
		
		auctionEnded = true
	end)()
end
