local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ws = workspace

local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()

local gui = Instance.new("ScreenGui")
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.DisplayOrder = 1e9
gui.Name = "LOADER"
gui.Parent = lp.PlayerGui

local bg = Instance.new("Frame", gui)
bg.Size = UDim2.new(1,0,1,0)
bg.BackgroundColor3 = Color3.new(0,0,0)

local container = Instance.new("Frame", bg)
container.AnchorPoint = Vector2.new(0.5,0.5)
container.Position = UDim2.new(0.5,0,0.5,0)
container.Size = UDim2.new(0.42,0,0.18,0)
container.BackgroundTransparency = 1

local outline = Instance.new("Frame", container)
outline.Size = UDim2.new(1,0,1,0)
outline.BackgroundColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", outline).CornerRadius = UDim.new(0,18)

local fill = Instance.new("Frame", outline)
fill.Position = UDim2.new(0.02,0,0.1,0)
fill.Size = UDim2.new(0,0,0.8,0)
fill.BackgroundColor3 = Color3.fromRGB(200,50,50)
Instance.new("UICorner", fill).CornerRadius = UDim.new(0,14)

local cap = Instance.new("Frame", container)
cap.AnchorPoint = Vector2.new(0,0.5)
cap.Position = UDim2.new(1,6,0.5,0)
cap.Size = UDim2.new(0,18,0.35,0)
cap.BackgroundColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", cap).CornerRadius = UDim.new(0,6)

local pct = Instance.new("TextLabel", container)
pct.Size = UDim2.new(1,0,1,0)
pct.BackgroundTransparency = 1
pct.Font = Enum.Font.GothamBlack
pct.TextScaled = true
pct.TextColor3 = Color3.new(1,1,1)
pct.Text = "0%"

local status = Instance.new("TextLabel", bg)
status.AnchorPoint = Vector2.new(0.5,0)
status.Position = UDim2.new(0.5,0,0.62,0)
status.Size = UDim2.new(0.9,0,0.06,0)
status.BackgroundTransparency = 1
status.Font = Enum.Font.GothamBold
status.TextScaled = true
status.TextColor3 = Color3.fromRGB(200,200,200)
status.Text = "üîÑ Loading‚Ä¶"

local progress,target = 0,0
RunService.RenderStepped:Connect(function()
	progress += (target-progress)*0.1
	progress = math.clamp(progress,0,100)
	fill.Size = UDim2.new((progress/100)*0.96,0,0.8,0)
	pct.Text = math.floor(progress).."%"
	if progress < 30 then
		fill.BackgroundColor3 = Color3.fromRGB(200,50,50)
	elseif progress < 70 then
		fill.BackgroundColor3 = Color3.fromRGB(220,180,40)
	else
		fill.BackgroundColor3 = Color3.fromRGB(80,220,120)
	end
end)

local function stage(p,t)
	target = p
	status.TextTransparency = 1
	status.Text = t
	TweenService:Create(status,TweenInfo.new(0.15),{TextTransparency=0}):Play()
	task.wait(0.5)
end

local keep = {}
local function k(x) if x then keep[x]=true end end

k(gui);k(bg);k(container);k(outline);k(fill);k(cap);k(pct);k(status)
k(ws.Camera)
k(char)

k(ReplicatedStorage)
for _,v in ipairs(ReplicatedStorage:GetDescendants()) do k(v) end

local worlds = ws:FindFirstChild("Worlds")
local cw = worlds and worlds:FindFirstChild("Christmas World")
k(worlds);k(cw)

if cw then
	for _,v in ipairs(cw:GetDescendants()) do k(v) end
end

local function protectCharacter(c)
	if not c then return end
	k(c)
	for _,v in ipairs(c:GetDescendants()) do k(v) end
end

protectCharacter(char)

lp.CharacterAdded:Connect(function(c)
	task.wait(0.4)
	protectCharacter(c)
end)

for _,g in ipairs(lp.PlayerGui:GetChildren()) do
	if g:IsA("ScreenGui") and g ~= gui then
		if g.Name:lower():find("snow") or g.Name:lower():find("flake") then
			k(g)
			for _,v in ipairs(g:GetDescendants()) do k(v) end
		end
	end
end

local surf = Instance.new("Part",ws)
surf.Size = Vector3.new(2000,20,2000)
surf.Position = Vector3.new(0,5,0)
surf.Anchored=true
surf.CanCollide=true
surf.Transparency=1
k(surf)

local function isChar(o)
	return lp.Character and (o==lp.Character or o:IsDescendantOf(lp.Character))
end

local function d(i)
	if i and i.Parent and not keep[i] and not isChar(i) then
		pcall(function() i:Destroy() end)
	end
end

local function batch(list,b,w)
	local i=1
	while i<=#list do
		for j=i,math.min(i+b-1,#list) do d(list[j]) end
		i+=b
		task.wait(w)
	end
end

local function collect(pred)
	local t={}
	for _,o in ipairs(ws:GetDescendants()) do
		if pred(o) and not keep[o] then table.insert(t,o) end
	end
	return t
end

stage(5,"üß® Destroying Worlds")
stage(10,"üíÄ Killing Server Players")
stage(15,"üß± Deleting Baseplates")

stage(20,"üñ•Ô∏è Erasing UI Layers")
batch(collect(function(o)
	return o:IsA("ScreenGui") or o:IsA("SurfaceGui") or o:IsA("BillboardGui")
end),10,0.3)

task.wait(0.6)
stage(35,"üéÜ Removing Visuals")
batch(collect(function(o)
	return o:IsA("MeshPart") or o:IsA("SpecialMesh") or o:IsA("UnionOperation")
	or o:IsA("Texture") or o:IsA("Decal") or o:IsA("ParticleEmitter")
	or o:IsA("Beam") or o:IsA("Trail") or o:IsA("Fire")
	or o:IsA("Smoke") or o:IsA("Sparkles") or o:IsA("Highlight")
	or o:IsA("SurfaceAppearance")
end),40,0.35)

task.wait(0.6)
stage(50,"üéØ Deleting Decorations")
batch(collect(function(o)
	return o:IsA("Adornment") or o:IsA("SelectionBox")
	or o:IsA("SelectionSphere") or o:IsA("ArcHandles")
end),20,0.3)

task.wait(0.6)
stage(65,"‚öôÔ∏è Setting Game Settings")

local RemoteEvent = ReplicatedStorage:WaitForChild("Shared")
	:WaitForChild("Framework")
	:WaitForChild("Network")
	:WaitForChild("Remote")
	:WaitForChild("RemoteEvent")

RemoteEvent:FireServer("SetSetting","Low Detail Mode",true)
RemoteEvent:FireServer("SetSetting","Ultra Low Detail Mode",true)

local settings = {
	"Hide Pet Notifications","Delete Legendary T3 Mythics","Compact Pet Inventory",
	"Skip Easy Mythics","Skip All Non-Secrets","Skip Secrets","Bubble Gravity",
	"Sound Effects","Mystery Box Visibility","Hide Bubbles","Item Notifications",
	"Hide Quests","Skip Easy Legendary","Hide Others Pets","Hide All Pets",
	"Hide Global Secret Messages"
}

task.spawn(function()
	while #settings > 0 do
		local i = math.random(1,#settings)
		RemoteEvent:FireServer("SetSetting",settings[i],true)
		table.remove(settings,i)
		task.wait(5)
	end
end)

stage(75,"‚öôÔ∏è Setting Game Settings")
stage(85,"‚öôÔ∏è Setting Game Settings")
stage(92,"‚öôÔ∏è Setting Game Settings")
stage(97,"‚öôÔ∏è Setting Game Settings")
stage(100,"‚öôÔ∏è Setting Game Settings")

pcall(function() RunService:Set3dRenderingEnabled(false) end)

task.wait(0.4)
TweenService:Create(bg,TweenInfo.new(0.25),{BackgroundTransparency=1}):Play()
task.wait(0.3)
gui:Destroy()
task.wait(0.05)
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local player = Players.LocalPlayer

-- Create FULL SCREEN BLACK UNCLOSABLE UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ChristmasUnlockerUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Pure black background covering 100% of screen
local BlackBackground = Instance.new("Frame")
BlackBackground.Name = "BlackBackground"
BlackBackground.Size = UDim2.new(1, 0, 1, 0)
BlackBackground.BackgroundColor3 = Color3.new(0, 0, 0)
BlackBackground.BackgroundTransparency = 0
BlackBackground.BorderSizePixel = 0
BlackBackground.Parent = ScreenGui

-- Username at the top
local UsernameLabel = Instance.new("TextLabel")
UsernameLabel.Name = "UsernameLabel"
UsernameLabel.Size = UDim2.new(1, 0, 0.08, 0)
UsernameLabel.Position = UDim2.new(0, 0, 0, 0)
UsernameLabel.BackgroundTransparency = 1
UsernameLabel.Text = "User: " .. player.Name
UsernameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
UsernameLabel.Font = Enum.Font.GothamBold
UsernameLabel.TextSize = 20
UsernameLabel.Parent = BlackBackground

-- Christmas World Status
local WorldStatus = Instance.new("TextLabel")
WorldStatus.Name = "WorldStatus"
WorldStatus.Size = UDim2.new(1, 0, 0.1, 0)
WorldStatus.Position = UDim2.new(0, 0, 0.1, 0)
WorldStatus.BackgroundTransparency = 1
WorldStatus.Text = "Christmas World Unlocked: checking..."
WorldStatus.TextColor3 = Color3.new(1, 1, 1)
WorldStatus.Font = Enum.Font.Gotham
WorldStatus.TextSize = 24
WorldStatus.Parent = BlackBackground

-- Islands Container
local IslandsContainer = Instance.new("ScrollingFrame")
IslandsContainer.Name = "IslandsContainer"
IslandsContainer.Size = UDim2.new(1, 0, 0.7, 0)
IslandsContainer.Position = UDim2.new(0, 0, 0.2, 0)
IslandsContainer.BackgroundTransparency = 1
IslandsContainer.ScrollBarThickness = 8
IslandsContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
IslandsContainer.Parent = BlackBackground

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 5)
UIListLayout.Parent = IslandsContainer

-- 100% Unlock Message
local FullUnlockMessage = Instance.new("TextLabel")
FullUnlockMessage.Name = "FullUnlockMessage"
FullUnlockMessage.Size = UDim2.new(1, 0, 0.5, 0)
FullUnlockMessage.Position = UDim2.new(0, 0, 0.25, 0)
FullUnlockMessage.BackgroundTransparency = 1
FullUnlockMessage.Text = ""
FullUnlockMessage.TextColor3 = Color3.fromRGB(100, 255, 100)
FullUnlockMessage.Font = Enum.Font.GothamBold
FullUnlockMessage.TextSize = 36
FullUnlockMessage.Visible = false
FullUnlockMessage.Parent = BlackBackground

-- Get Christmas World data
local christmasWorld = workspace.Worlds:FindFirstChild("Christmas World")
local islandsFolder = christmasWorld and christmasWorld:FindFirstChild("Islands")

-- Create island display items
local islandDisplays = {}
local allIslandNames = {}

if islandsFolder then
    for _, isl in ipairs(islandsFolder:GetChildren()) do
        local islandName = isl.Name
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 0, 35)
        frame.BackgroundTransparency = 1
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(0.7, 0, 1, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = islandName
        nameLabel.TextColor3 = Color3.new(1, 1, 1)
        nameLabel.Font = Enum.Font.Gotham
        nameLabel.TextSize = 18
        nameLabel.TextXAlignment = Enum.TextXAlignment.Left
        nameLabel.Parent = frame
        
        local statusLabel = Instance.new("TextLabel")
        statusLabel.Size = UDim2.new(0.3, 0, 1, 0)
        statusLabel.Position = UDim2.new(0.7, 0, 0, 0)
        statusLabel.BackgroundTransparency = 1
        statusLabel.Text = "checking..."
        statusLabel.TextColor3 = Color3.new(1, 1, 1)
        statusLabel.Font = Enum.Font.Gotham
        statusLabel.TextSize = 18
        statusLabel.TextXAlignment = Enum.TextXAlignment.Right
        statusLabel.Parent = frame
        
        frame.Parent = IslandsContainer
        islandDisplays[islandName] = statusLabel
        table.insert(allIslandNames, islandName)
    end
    
    IslandsContainer.CanvasSize = UDim2.new(0, 0, 0, #allIslandNames * 40)
end

-- Update function
local function updateDisplay()
    local data = LocalData:Get()
    
    -- Check Christmas World unlock
    local worldUnlocked = false
    if data then
        if data.WorldsUnlocked and data.WorldsUnlocked["Christmas World"] then
            worldUnlocked = true
        elseif data.UnlockedWorlds and data.UnlockedWorlds["Christmas World"] then
            worldUnlocked = true
        elseif data.Worlds and data.Worlds["Christmas World"] then
            worldUnlocked = true
        end
    end
    
    WorldStatus.Text = "Christmas World Unlocked: " .. (worldUnlocked and "‚úÖ TRUE" or "‚ùå FALSE")
    WorldStatus.TextColor3 = worldUnlocked and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 100, 100)
    
    -- Check island unlocks
    local allUnlocked = true
    
    local unlockedIslands = data and data.AreasUnlocked or {}
    
    for _, islandName in ipairs(allIslandNames) do
        local isUnlocked = unlockedIslands[islandName] and true or false
        local statusLabel = islandDisplays[islandName]
        
        if statusLabel then
            statusLabel.Text = isUnlocked and "‚úÖ TRUE" or "‚ùå FALSE"
            statusLabel.TextColor3 = isUnlocked and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 100, 100)
        end
        
        if not isUnlocked then
            allUnlocked = false
        end
    end
    
    -- Check if everything is unlocked
    if worldUnlocked and allUnlocked then
        -- Hide all status displays
        WorldStatus.Visible = false
        IslandsContainer.Visible = false
        
        -- Show completion message covering the screen
        FullUnlockMessage.Text = "üéâ CHRISTMAS WORLD IS 100% UNLOCKED !!"
        FullUnlockMessage.Visible = true
    else
        -- Show normal status
        WorldStatus.Visible = true
        IslandsContainer.Visible = true
        FullUnlockMessage.Visible = false
    end
end

-- Auto-update loop
task.spawn(function()
    while ScreenGui.Parent do
        updateDisplay()
        task.wait(1)
    end
end)

-- Initial update
updateDisplay()
task.wait(0.05)
for _,g in ipairs(game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui"):GetChildren()) do if g:IsA("ScreenGui") then g:Destroy() end end
task.wait(2)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local function checkUnlocks()
    local data = LocalData:Get()
    local christmasWorld = workspace.Worlds:FindFirstChild("Christmas World")
    
    if not christmasWorld then return false end
    
    local worldsUnlocked = data.WorldsUnlocked or data.UnlockedWorlds or data.Worlds or {}
    local areasUnlocked = data.AreasUnlocked or {}
    
    local islandsFolder = christmasWorld:FindFirstChild("Islands")
    if not islandsFolder then return false end
    
    local allIslandsUnlocked = true
    
    for _, island in pairs(islandsFolder:GetChildren()) do
        if not areasUnlocked[island.Name] then
            allIslandsUnlocked = false
            break
        end
    end
    
    return (worldsUnlocked["Christmas World"] == true) and allIslandsUnlocked
end

task.spawn(function()
    while true do
        if checkUnlocks() then
local Players = game:GetService("Players")
local lp = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local LocalData = nil
pcall(function() LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData) end)
local PetsModule = nil
pcall(function() PetsModule = require(ReplicatedStorage.Shared.Data.Pets) end)

local function waitForDataReady()
    if LocalData and LocalData.IsReady and not LocalData:IsReady() and LocalData.DataReady then
        LocalData.DataReady:Wait()
    end
end

local function gd()
    local ok, d = pcall(function() return (LocalData and LocalData.Get) and LocalData:Get() or {} end)
    return ok and d or {}
end

local function fmt_num(n)
    n = tonumber(n) or 0
    if n >= 1e12 then return string.format("%.2fT", n/1e12)
    elseif n >= 1e9 then return string.format("%.2fB", n/1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n/1e6)
    elseif n >= 1e3 then return string.format("%.2fK", n/1e3)
    else return tostring(n) end
end

local function getSnow() return gd().Snowflakes or 0 end
local function getHatches() return gd().Stats and gd().Stats.Hatches or 0 end
local function getHatchesRaw()
    local d = gd()
    return (d.Stats and d.Stats.Hatches) or 0
end
local function getXmas() return gd().MasteryLevels and gd().MasteryLevels.Christmas or 0 end

local CHEST_NAME = "Peppermint Chest"
local function getPepRemainingSeconds()
    local data = gd()
    local cds = data.Cooldowns
    if type(cds) ~= "table" then return nil end
    local ts = cds[CHEST_NAME] or cds["PeppermintChest"] or cds["Peppermint"]
    if type(ts) == "number" then
        local now = os.time()
        return math.max(0, ts - now)
    end
    return nil
end

local function fmt_hms(sec)
    sec = math.max(0, math.floor(sec or 0))
    local h = math.floor(sec/3600)
    local m = math.floor((sec%3600)/60)
    local s = sec%60
    return string.format("%02d:%02d:%02d", h, m, s)
end

local function fmt_mmss_or_ready(sec)
    if sec == nil then return "NOT FOUND" end
    sec = math.max(0, math.floor(sec))
    if sec == 0 then return "READY !" end
    local m = math.floor(sec/60)
    local s = sec % 60
    return string.format("%02d:%02d", m, s)
end

local function getPotionsTwoLines()
    local data = gd()
    local festiveInfinity = 0
    local festiveElixirs = 0

    if data and data.Potions then
        for _, pot in pairs(data.Potions) do
            if type(pot) == "table" and pot.Name and pot.Amount then
                local name = tostring(pot.Name)
                if name:find("Festive Infinity Elixir", 1, true) then
                    festiveInfinity = festiveInfinity + (tonumber(pot.Amount) or 0)
                elseif name:find("Festive Elixir", 1, true) then
                    festiveElixirs = festiveElixirs + (tonumber(pot.Amount) or 0)
                end
            end
        end
    end

    return festiveInfinity, festiveElixirs
end

local ITEMS = {"Christmas Present","Christmas Key","Christmas Spin Ticket"}
local function getItems()
    local d = gd()
    local r = {}
    local function scan(t)
        for k, v in pairs(t) do
            if type(v) == "table" then
                scan(v)
            else
                for _, nm in ipairs(ITEMS) do
                    if k == nm then r[nm] = v end
                end
            end
        end
    end
    scan(d)
    return r
end

local function getTeam()
    local d = gd()
    local ids = (d.Teams and d.TeamEquipped and d.Teams[d.TeamEquipped]
        and d.Teams[d.TeamEquipped].Pets) or {}
    local map = {}
    if d.Pets then for _,p in pairs(d.Pets) do map[tostring(p.Id)] = p end end
    local arr = {} local sum = 0
    for _, id in ipairs(ids) do
        local p = map[tostring(id)]
        if p and PetsModule and PetsModule[p.Name] and PetsModule[p.Name].Stats then
            local sf = PetsModule[p.Name].Stats.Snowflakes or 0
            sum = sum + sf
            arr[#arr+1] = { Name = p.Name, Snow = sf, Id = p.Id, Enchants = p.Enchants }
        end
    end
    return arr, sum
end

local gui = Instance.new("ScreenGui", lp.PlayerGui)
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.DisplayOrder = 9999999

local bg = Instance.new("Frame", gui)
bg.Size = UDim2.new(1,0,1,0)
bg.BackgroundColor3 = Color3.fromRGB(0,0,0)
bg.BackgroundTransparency = 0

local function Section(x,y,w,h)
    local f = Instance.new("Frame", bg)
    f.AnchorPoint = Vector2.new(0.5,0.5)
    f.Position = UDim2.new(x,0,y,0)
    f.Size = UDim2.new(w,0,h,0)
    f.BackgroundTransparency = 1
    local ar = Instance.new("UIAspectRatioConstraint", f)
    ar.AspectRatio = 4
    ar.DominantAxis = Enum.DominantAxis.Height
    return f
end

local function NewText(p)
    local t = Instance.new("TextLabel", p)
    t.Size = UDim2.new(1,0,1,0)
    t.BackgroundTransparency = 1
    t.Font = Enum.Font.GothamBlack
    t.TextScaled = true
    t.TextColor3 = Color3.fromRGB(255,255,255)
    t.TextWrapped = true
    t.TextXAlignment = Enum.TextXAlignment.Center
    return t
end

local user = Section(0.5,0.12,0.6,0.1)
local USER = NewText(user)
USER.Text = "ü•ö  "..lp.Name

local snowBig = Section(0.5,0.22,0.7,0.18)
local BIG = NewText(snowBig)

local snowRate = Section(0.5,0.34,0.5,0.12)
local RATE = NewText(snowRate)

local topLeft = Section(0.22,0.08,0.4,0.12)
local TL = NewText(topLeft)
TL.TextXAlignment = Enum.TextXAlignment.Left
TL.TextScaled = true
TL.Font = Enum.Font.GothamBlack

local sessionTopRight = Section(0.78,0.08,0.36,0.08)
local SESSION = NewText(sessionTopRight)
SESSION.TextXAlignment = Enum.TextXAlignment.Center
SESSION.TextScaled = true
SESSION.Font = Enum.Font.GothamBlack

local pepSection = Section(0.78,0.14,0.20,0.05)
local PEP = Instance.new("TextLabel", pepSection)
PEP.Size = UDim2.new(1,0,1,0)
PEP.BackgroundTransparency = 1
PEP.Font = Enum.Font.GothamBlack
PEP.TextScaled = true
PEP.TextColor3 = Color3.fromRGB(255,255,255)
PEP.TextWrapped = true
PEP.TextXAlignment = Enum.TextXAlignment.Center
PEP.TextYAlignment = Enum.TextYAlignment.Center

local midLeft = Section(0.22,0.50,0.42,0.09)
local ML = NewText(midLeft)
ML.TextXAlignment = Enum.TextXAlignment.Left

local midRight = Section(0.88,0.30,0.42,0.09)
local MR = NewText(midRight)
MR.TextXAlignment = Enum.TextXAlignment.Right

local msgBar = Section(0.52,0.50,0.75,0.11)
local MSG = NewText(msgBar)
MSG.TextTransparency = 1
MSG.TextWrapped = true

local petsFrame = Instance.new("Frame", bg)
petsFrame.AnchorPoint = Vector2.new(0,1)
petsFrame.Position = UDim2.new(0.02,0,0.86,0)
petsFrame.Size = UDim2.new(0.38,0,0.22,0)
petsFrame.BackgroundColor3 = Color3.fromRGB(18,18,20)
local petsCorner = Instance.new("UICorner", petsFrame)

local petsTitle = Instance.new("TextLabel", petsFrame)
petsTitle.Size = UDim2.new(1,-16,0,22)
petsTitle.Position = UDim2.new(0,8,0,6)
petsTitle.BackgroundTransparency = 1
petsTitle.Font = Enum.Font.GothamBold
petsTitle.TextSize = 16
petsTitle.TextColor3 = Color3.fromRGB(255,255,255)
petsTitle.Text = "üêæ Equipped Pets"
petsTitle.TextXAlignment = Enum.TextXAlignment.Left

local petsList = Instance.new("TextLabel", petsFrame)
petsList.Size = UDim2.new(1,-16,1,-34)
petsList.Position = UDim2.new(0,8,0,30)
petsList.BackgroundTransparency = 1
petsList.Font = Enum.Font.Gotham
petsList.TextSize = 16
petsList.TextColor3 = Color3.fromRGB(220,220,220)
petsList.TextWrapped = true
petsList.TextXAlignment = Enum.TextXAlignment.Left
petsList.TextYAlignment = Enum.TextYAlignment.Top

local multiFrame = Instance.new("Frame", bg)
multiFrame.AnchorPoint = Vector2.new(1,1)
multiFrame.Position = UDim2.new(0.98,0,0.86,0)
multiFrame.Size = UDim2.new(0.22,0,0.22,0)
multiFrame.BackgroundColor3 = Color3.fromRGB(18,18,20)
local multiCorner = Instance.new("UICorner", multiFrame)

local multiTitle = Instance.new("TextLabel", multiFrame)
multiTitle.Size = UDim2.new(1,-16,0,24)
multiTitle.Position = UDim2.new(0,8,0,6)
multiTitle.BackgroundTransparency = 1
multiTitle.Font = Enum.Font.GothamBold
multiTitle.TextSize = 14
multiTitle.TextColor3 = Color3.fromRGB(255,255,255)
multiTitle.Text = "‚ú® Enchant Status"
multiTitle.TextXAlignment = Enum.TextXAlignment.Left

local enchantList = Instance.new("TextLabel", multiFrame)
enchantList.Size = UDim2.new(1,-16,1,-36)
enchantList.Position = UDim2.new(0,8,0,30)
enchantList.BackgroundTransparency = 1
enchantList.Font = Enum.Font.Gotham
enchantList.TextSize = 14
enchantList.TextColor3 = Color3.fromRGB(220,220,220)
enchantList.TextWrapped = true
enchantList.TextXAlignment = Enum.TextXAlignment.Left
enchantList.TextYAlignment = Enum.TextYAlignment.Top

local hatchFrame = Instance.new("Frame", bg)
hatchFrame.AnchorPoint = Vector2.new(0.5,1)
hatchFrame.Size = UDim2.new(0.12,0,0.10,0)
hatchFrame.BackgroundColor3 = Color3.fromRGB(24,24,26)
local hatchCorner = Instance.new("UICorner", hatchFrame)
local hatchLabel = Instance.new("TextLabel", hatchFrame)
hatchLabel.Size = UDim2.new(1,0,1,0)
hatchLabel.BackgroundTransparency = 1
hatchLabel.Font = Enum.Font.GothamBlack
hatchLabel.TextScaled = true
hatchLabel.TextColor3 = Color3.fromRGB(255,255,255)
hatchLabel.TextWrapped = true
hatchLabel.TextXAlignment = Enum.TextXAlignment.Center
hatchLabel.TextYAlignment = Enum.TextYAlignment.Center

local function findPetById(petId)
    local playerData = gd()
    if not (playerData and playerData.Pets) then return nil end
    for _, pet in ipairs(playerData.Pets) do
        if pet and pet.Id == petId then return pet end
    end
    return nil
end

local function hasTeamUpEnchant(pet)
    local enchants = pet and pet.Enchants or {}
    for _, currentEnchant in ipairs(enchants) do
        if currentEnchant.Id and string.lower(currentEnchant.Id):sub(1,7) == "team-up" then
            return true
        end
    end
    return false
end

local function firstEnchantId(pet)
    if not pet or not pet.Enchants or #pet.Enchants == 0 then return "None" end
    return pet.Enchants[1].Id or "None"
end

local function buildEnchantLinesAll()
    local teamArr, _ = getTeam()
    if #teamArr == 0 then return {} end

    local lines = {}
    for _, p in ipairs(teamArr) do
        local petData = findPetById(p.Id) or p
        local name = petData.Name or ("Pet "..tostring(p.Id))
        local enchId = firstEnchantId(petData)
        local tickMark = hasTeamUpEnchant(petData) and "‚úÖ" or "‚ùå"
        local dispEnchant = tostring(enchId):gsub("_", " ")
        lines[#lines+1] = string.format("üêæ %s > %s %s", name, dispEnchant, tickMark)
    end

    return lines
end

local samples = {}
local shown = 0
local function push(v)
    samples[#samples+1] = {t = tick(), v = v}
    while #samples > 1 and tick() - samples[1].t > 60 do table.remove(samples, 1) end
end
local function perMin()
    if #samples < 2 then return 0 end
    local a = samples[1]
    local b = samples[#samples]
    if b.t - a.t <= 0 or b.v - a.v < 0 then return 0 end
    return ((b.v - a.v) / (b.t - a.t)) * 60
end

local startTick = tick()
local last = { snow = getSnow(), presents = 0, keys = 0, spins = 0, xmas = getXmas(), hatches = getHatches() }
local function fadeMsg(t)
    MSG.Text = t
    MSG.Position = UDim2.new(0.52,0,0.50,18)
    MSG.TextTransparency = 1
    TweenService:Create(MSG, TweenInfo.new(0.5), { TextTransparency = 0, Position = UDim2.new(0.52,0,0.50,0) }):Play()
end
local queue = {}
local function addMsg(m) if queue[#queue] ~= m then queue[#queue+1] = m end end

local function getPowerups()
    return (gd().Powerups) or {}
end

local oldPowerups = {}
do
    local t = getPowerups()
    for k,v in pairs(t) do oldPowerups[k] = v end
end

task.spawn(function()
    waitForDataReady()

    while true do
        local snow = getSnow()
        push(snow)

        local items = getItems()
        local pres = items["Christmas Present"] or 0
        local keys = items["Christmas Key"] or 0
        local spins = items["Christmas Spin Ticket"] or 0
        local xmas = getXmas()
        local htc = getHatches()

        if xmas > last.xmas then addMsg("üéÑ Upgraded Xmas Mastery!") end
        if keys < last.keys then addMsg("üóùÔ∏è Opening Christmas Chest‚Ä¶") end
        if keys > last.keys then addMsg("üóùÔ∏è +"..fmt_num(keys-last.keys).." Christmas Keys!") end
        if spins < last.spins then addMsg("üé° Spinning Christmas Wheel‚Ä¶") end
        if spins > last.spins then addMsg("üé° +"..fmt_num(spins-last.spins).." Christmas Spins!") end
        if pres > last.presents then addMsg("üéÅ +"..fmt_num(pres-last.presents).." Christmas Presents!") end
        if snow > last.snow then addMsg("‚ùÑÔ∏è Automatically Giving Gifts‚Ä¶") end
        if snow < last.snow and htc > last.hatches then addMsg("ü•ö Hatching Eggs: +"..fmt_num(htc-last.hatches)) end

        -- powerups change detection -> add message like "+50 NAME"
        local newPowerups = getPowerups()
        for name, amount in pairs(newPowerups) do
            local oldAmount = oldPowerups[name] or 0
            if tonumber(amount) and tonumber(amount) > (tonumber(oldAmount) or 0) then
                addMsg("‚ûï "..tostring(tonumber(amount) - (tonumber(oldAmount) or 0)).." "..tostring(name))
            end
        end
        oldPowerups = {}
        for k,v in pairs(newPowerups) do oldPowerups[k] = v end

        last.snow = snow last.presents = pres last.keys = keys last.spins = spins last.xmas = xmas last.hatches = htc

        local s0 = shown local s1 = snow local t0 = tick()
        local c; c = RunService.Heartbeat:Connect(function()
            local a = math.clamp((tick()-t0)/0.3,0,1)
            shown = s0 + (s1 - s0)*a
            BIG.Text = "‚ùÑÔ∏è "..fmt_num(shown)
            if a >= 1 then c:Disconnect() end
        end)

        RATE.Text = "‚ùÑÔ∏è/min: "..fmt_num(perMin())

        local elapsed = math.floor(tick() - startTick)
        local hhmmss = fmt_hms(elapsed)
        SESSION.Text = "‚è±Ô∏è Session: "..hhmmss

        local pepSecs = getPepRemainingSeconds()
        local pepDisplay = fmt_mmss_or_ready(pepSecs)
        PEP.Text = "üç¨ Peppermint Chest :\n   "..pepDisplay

        local inf, elix = getPotionsTwoLines()
        TL.Text = string.format("üß™ Inventory potions\n‚ú® Festive Infinity Elixirs : %s\nüîÆ Festive Elixirs : %s", fmt_num(inf), fmt_num(elix))

        ML.Text = "üéÅ Christmas Presents: "..fmt_num(pres)
        MR.Text = "üóùÔ∏è "..fmt_num(keys).."\nüé° "..fmt_num(spins)

        local arr, sum = getTeam()
        if #arr > 0 then
            local lines = {}
            lines[#lines+1] = "‚ùÑÔ∏è Total Multi : "..fmt_num(sum)
            lines[#lines+1] = ""
            local petRows = {}
            for i = 1, #arr do
                local e = "üêæ "..arr[i].Name.." x"..fmt_num(arr[i].Snow).." ‚ùÑÔ∏è"
                local r = math.floor((i-1)/3)+1
                petRows[r] = petRows[r] and (petRows[r].."      "..e) or e
            end
            for _, pr in ipairs(petRows) do lines[#lines+1] = pr end
            petsList.Text = table.concat(lines, "\n")
        else
            petsList.Text = "None"
        end

        local enchantLines = buildEnchantLinesAll()
        if #enchantLines > 0 then
            enchantList.Text = table.concat(enchantLines, "\n")
        else
            enchantList.Text = "No Equipped Pets"
        end

        local petPos, petSize = petsFrame.AbsolutePosition, petsFrame.AbsoluteSize
        local multiPos, multiSize = multiFrame.AbsolutePosition, multiFrame.AbsoluteSize
        local midX = (petPos.X + petSize.X/2 + multiPos.X + multiSize.X/2) / 2
        local midY = petPos.Y + petSize.Y
        if bg.AbsoluteSize.X > 0 and bg.AbsoluteSize.Y > 0 then
            hatchFrame.Position = UDim2.new(midX / bg.AbsoluteSize.X, 0, midY / bg.AbsoluteSize.Y, 0)
        end
        hatchLabel.Text = "ü•ö "..tostring(getHatchesRaw())

        if #queue > 0 then
            local m = table.remove(queue,1)
            fadeMsg(m)
            task.wait(math.random(3,10))
            TweenService:Create(MSG, TweenInfo.new(0.35), { TextTransparency = 1, Position = UDim2.new(0.52,0,0.50,18) }):Play()
        else
            MSG.Text = ""
        end

        task.wait(1)
    end
end)

            break
        end
        task.wait(5)
    end
end)
