local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ws = workspace

local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()

local gui = Instance.new("ScreenGui")
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.DisplayOrder = 1e9
gui.Name = "LOADER"
gui.Parent = lp.PlayerGui

local bg = Instance.new("Frame", gui)
bg.Size = UDim2.new(1,0,1,0)
bg.BackgroundColor3 = Color3.new(0,0,0)

local container = Instance.new("Frame", bg)
container.AnchorPoint = Vector2.new(0.5,0.5)
container.Position = UDim2.new(0.5,0,0.5,0)
container.Size = UDim2.new(0.42,0,0.18,0)
container.BackgroundTransparency = 1

local outline = Instance.new("Frame", container)
outline.Size = UDim2.new(1,0,1,0)
outline.BackgroundColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", outline).CornerRadius = UDim.new(0,18)

local fill = Instance.new("Frame", outline)
fill.Position = UDim2.new(0.02,0,0.1,0)
fill.Size = UDim2.new(0,0,0.8,0)
fill.BackgroundColor3 = Color3.fromRGB(200,50,50)
Instance.new("UICorner", fill).CornerRadius = UDim.new(0,14)

local cap = Instance.new("Frame", container)
cap.AnchorPoint = Vector2.new(0,0.5)
cap.Position = UDim2.new(1,6,0.5,0)
cap.Size = UDim2.new(0,18,0.35,0)
cap.BackgroundColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", cap).CornerRadius = UDim.new(0,6)

local pct = Instance.new("TextLabel", container)
pct.Size = UDim2.new(1,0,1,0)
pct.BackgroundTransparency = 1
pct.Font = Enum.Font.GothamBlack
pct.TextScaled = true
pct.TextColor3 = Color3.new(1,1,1)
pct.Text = "0%"

local status = Instance.new("TextLabel", bg)
status.AnchorPoint = Vector2.new(0.5,0)
status.Position = UDim2.new(0.5,0,0.62,0)
status.Size = UDim2.new(0.9,0,0.06,0)
status.BackgroundTransparency = 1
status.Font = Enum.Font.GothamBold
status.TextScaled = true
status.TextColor3 = Color3.fromRGB(200,200,200)
status.Text = "üîÑ Loading‚Ä¶"

local progress,target = 0,0
RunService.RenderStepped:Connect(function()
	progress += (target-progress)*0.1
	progress = math.clamp(progress,0,100)
	fill.Size = UDim2.new((progress/100)*0.96,0,0.8,0)
	pct.Text = math.floor(progress).."%"
	if progress < 30 then
		fill.BackgroundColor3 = Color3.fromRGB(200,50,50)
	elseif progress < 70 then
		fill.BackgroundColor3 = Color3.fromRGB(220,180,40)
	else
		fill.BackgroundColor3 = Color3.fromRGB(80,220,120)
	end
end)

local function stage(p,t)
	target = p
	status.TextTransparency = 1
	status.Text = t
	TweenService:Create(status,TweenInfo.new(0.15),{TextTransparency=0}):Play()
	task.wait(0.5)
end

local keep = {}
local function k(x) if x then keep[x]=true end end

k(gui);k(bg);k(container);k(outline);k(fill);k(cap);k(pct);k(status)
k(ws.Camera)
k(char)

k(ReplicatedStorage)
for _,v in ipairs(ReplicatedStorage:GetDescendants()) do k(v) end

local worlds = ws:FindFirstChild("Worlds")
local cw = worlds and worlds:FindFirstChild("Christmas World")
k(worlds);k(cw)

if cw then
	for _,v in ipairs(cw:GetDescendants()) do k(v) end
end

local function protectCharacter(c)
	if not c then return end
	k(c)
	for _,v in ipairs(c:GetDescendants()) do k(v) end
end

protectCharacter(char)

lp.CharacterAdded:Connect(function(c)
	task.wait(0.4)
	protectCharacter(c)
end)

for _,g in ipairs(lp.PlayerGui:GetChildren()) do
	if g:IsA("ScreenGui") and g ~= gui then
		if g.Name:lower():find("snow") or g.Name:lower():find("flake") then
			k(g)
			for _,v in ipairs(g:GetDescendants()) do k(v) end
		end
	end
end

local surf = Instance.new("Part",ws)
surf.Size = Vector3.new(2000,20,2000)
surf.Position = Vector3.new(0,5,0)
surf.Anchored=true
surf.CanCollide=true
surf.Transparency=1
k(surf)

local function isChar(o)
	return lp.Character and (o==lp.Character or o:IsDescendantOf(lp.Character))
end

local function d(i)
	if i and i.Parent and not keep[i] and not isChar(i) then
		pcall(function() i:Destroy() end)
	end
end

local function batch(list,b,w)
	local i=1
	while i<=#list do
		for j=i,math.min(i+b-1,#list) do d(list[j]) end
		i+=b
		task.wait(w)
	end
end

local function collect(pred)
	local t={}
	for _,o in ipairs(ws:GetDescendants()) do
		if pred(o) and not keep[o] then table.insert(t,o) end
	end
	return t
end

stage(5,"üß® Destroying Worlds")
stage(10,"üíÄ Killing Server Players")
stage(15,"üß± Deleting Baseplates")

stage(20,"üñ•Ô∏è Erasing UI Layers")
batch(collect(function(o)
	return o:IsA("ScreenGui") or o:IsA("SurfaceGui") or o:IsA("BillboardGui")
end),10,0.3)

task.wait(0.6)
stage(35,"üéÜ Removing Visuals")
batch(collect(function(o)
	return o:IsA("MeshPart") or o:IsA("SpecialMesh") or o:IsA("UnionOperation")
	or o:IsA("Texture") or o:IsA("Decal") or o:IsA("ParticleEmitter")
	or o:IsA("Beam") or o:IsA("Trail") or o:IsA("Fire")
	or o:IsA("Smoke") or o:IsA("Sparkles") or o:IsA("Highlight")
	or o:IsA("SurfaceAppearance")
end),40,0.35)

task.wait(0.6)
stage(50,"üéØ Deleting Decorations")
batch(collect(function(o)
	return o:IsA("Adornment") or o:IsA("SelectionBox")
	or o:IsA("SelectionSphere") or o:IsA("ArcHandles")
end),20,0.3)

task.wait(0.6)
stage(65,"‚öôÔ∏è Setting Game Settings")

local RemoteEvent = ReplicatedStorage:WaitForChild("Shared")
	:WaitForChild("Framework")
	:WaitForChild("Network")
	:WaitForChild("Remote")
	:WaitForChild("RemoteEvent")

RemoteEvent:FireServer("SetSetting","Low Detail Mode",true)
RemoteEvent:FireServer("SetSetting","Ultra Low Detail Mode",true)

local settings = {
	"Hide Pet Notifications","Delete Legendary T3 Mythics","Compact Pet Inventory",
	"Skip Easy Mythics","Skip All Non-Secrets","Skip Secrets","Bubble Gravity",
	"Sound Effects","Mystery Box Visibility","Hide Bubbles","Item Notifications",
	"Hide Quests","Skip Easy Legendary","Hide Others Pets","Hide All Pets",
	"Hide Global Secret Messages"
}

task.spawn(function()
	while #settings > 0 do
		local i = math.random(1,#settings)
		RemoteEvent:FireServer("SetSetting",settings[i],true)
		table.remove(settings,i)
		task.wait(5)
	end
end)

stage(75,"‚öôÔ∏è Setting Game Settings")
stage(85,"‚öôÔ∏è Setting Game Settings")
stage(92,"‚öôÔ∏è Setting Game Settings")
stage(97,"‚öôÔ∏è Setting Game Settings")
stage(100,"‚öôÔ∏è Setting Game Settings")

pcall(function() RunService:Set3dRenderingEnabled(false) end)

task.wait(0.4)
TweenService:Create(bg,TweenInfo.new(0.25),{BackgroundTransparency=1}):Play()
task.wait(0.3)
gui:Destroy()
task.wait(0.05)
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local player = Players.LocalPlayer

-- Create FULL SCREEN BLACK UNCLOSABLE UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ChristmasUnlockerUI"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Pure black background covering 100% of screen
local BlackBackground = Instance.new("Frame")
BlackBackground.Name = "BlackBackground"
BlackBackground.Size = UDim2.new(1, 0, 1, 0)
BlackBackground.BackgroundColor3 = Color3.new(0, 0, 0)
BlackBackground.BackgroundTransparency = 0
BlackBackground.BorderSizePixel = 0
BlackBackground.Parent = ScreenGui

-- Username at the top
local UsernameLabel = Instance.new("TextLabel")
UsernameLabel.Name = "UsernameLabel"
UsernameLabel.Size = UDim2.new(1, 0, 0.08, 0)
UsernameLabel.Position = UDim2.new(0, 0, 0, 0)
UsernameLabel.BackgroundTransparency = 1
UsernameLabel.Text = "User: " .. player.Name
UsernameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
UsernameLabel.Font = Enum.Font.GothamBold
UsernameLabel.TextSize = 20
UsernameLabel.Parent = BlackBackground

-- Christmas World Status
local WorldStatus = Instance.new("TextLabel")
WorldStatus.Name = "WorldStatus"
WorldStatus.Size = UDim2.new(1, 0, 0.1, 0)
WorldStatus.Position = UDim2.new(0, 0, 0.1, 0)
WorldStatus.BackgroundTransparency = 1
WorldStatus.Text = "Christmas World Unlocked: checking..."
WorldStatus.TextColor3 = Color3.new(1, 1, 1)
WorldStatus.Font = Enum.Font.Gotham
WorldStatus.TextSize = 24
WorldStatus.Parent = BlackBackground

-- Islands Container
local IslandsContainer = Instance.new("ScrollingFrame")
IslandsContainer.Name = "IslandsContainer"
IslandsContainer.Size = UDim2.new(1, 0, 0.7, 0)
IslandsContainer.Position = UDim2.new(0, 0, 0.2, 0)
IslandsContainer.BackgroundTransparency = 1
IslandsContainer.ScrollBarThickness = 8
IslandsContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
IslandsContainer.Parent = BlackBackground

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 5)
UIListLayout.Parent = IslandsContainer

-- 100% Unlock Message
local FullUnlockMessage = Instance.new("TextLabel")
FullUnlockMessage.Name = "FullUnlockMessage"
FullUnlockMessage.Size = UDim2.new(1, 0, 0.5, 0)
FullUnlockMessage.Position = UDim2.new(0, 0, 0.25, 0)
FullUnlockMessage.BackgroundTransparency = 1
FullUnlockMessage.Text = ""
FullUnlockMessage.TextColor3 = Color3.fromRGB(100, 255, 100)
FullUnlockMessage.Font = Enum.Font.GothamBold
FullUnlockMessage.TextSize = 36
FullUnlockMessage.Visible = false
FullUnlockMessage.Parent = BlackBackground

-- Get Christmas World data
local christmasWorld = workspace.Worlds:FindFirstChild("Christmas World")
local islandsFolder = christmasWorld and christmasWorld:FindFirstChild("Islands")

-- Create island display items
local islandDisplays = {}
local allIslandNames = {}

if islandsFolder then
    for _, isl in ipairs(islandsFolder:GetChildren()) do
        local islandName = isl.Name
        
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(1, 0, 0, 35)
        frame.BackgroundTransparency = 1
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(0.7, 0, 1, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = islandName
        nameLabel.TextColor3 = Color3.new(1, 1, 1)
        nameLabel.Font = Enum.Font.Gotham
        nameLabel.TextSize = 18
        nameLabel.TextXAlignment = Enum.TextXAlignment.Left
        nameLabel.Parent = frame
        
        local statusLabel = Instance.new("TextLabel")
        statusLabel.Size = UDim2.new(0.3, 0, 1, 0)
        statusLabel.Position = UDim2.new(0.7, 0, 0, 0)
        statusLabel.BackgroundTransparency = 1
        statusLabel.Text = "checking..."
        statusLabel.TextColor3 = Color3.new(1, 1, 1)
        statusLabel.Font = Enum.Font.Gotham
        statusLabel.TextSize = 18
        statusLabel.TextXAlignment = Enum.TextXAlignment.Right
        statusLabel.Parent = frame
        
        frame.Parent = IslandsContainer
        islandDisplays[islandName] = statusLabel
        table.insert(allIslandNames, islandName)
    end
    
    IslandsContainer.CanvasSize = UDim2.new(0, 0, 0, #allIslandNames * 40)
end

-- Update function
local function updateDisplay()
    local data = LocalData:Get()
    
    -- Check Christmas World unlock
    local worldUnlocked = false
    if data then
        if data.WorldsUnlocked and data.WorldsUnlocked["Christmas World"] then
            worldUnlocked = true
        elseif data.UnlockedWorlds and data.UnlockedWorlds["Christmas World"] then
            worldUnlocked = true
        elseif data.Worlds and data.Worlds["Christmas World"] then
            worldUnlocked = true
        end
    end
    
    WorldStatus.Text = "Christmas World Unlocked: " .. (worldUnlocked and "‚úÖ TRUE" or "‚ùå FALSE")
    WorldStatus.TextColor3 = worldUnlocked and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 100, 100)
    
    -- Check island unlocks
    local allUnlocked = true
    
    local unlockedIslands = data and data.AreasUnlocked or {}
    
    for _, islandName in ipairs(allIslandNames) do
        local isUnlocked = unlockedIslands[islandName] and true or false
        local statusLabel = islandDisplays[islandName]
        
        if statusLabel then
            statusLabel.Text = isUnlocked and "‚úÖ TRUE" or "‚ùå FALSE"
            statusLabel.TextColor3 = isUnlocked and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(255, 100, 100)
        end
        
        if not isUnlocked then
            allUnlocked = false
        end
    end
    
    -- Check if everything is unlocked
    if worldUnlocked and allUnlocked then
        -- Hide all status displays
        WorldStatus.Visible = false
        IslandsContainer.Visible = false
        
        -- Show completion message covering the screen
        FullUnlockMessage.Text = "üéâ CHRISTMAS WORLD IS 100% UNLOCKED !!"
        FullUnlockMessage.Visible = true
    else
        -- Show normal status
        WorldStatus.Visible = true
        IslandsContainer.Visible = true
        FullUnlockMessage.Visible = false
    end
end

-- Auto-update loop
task.spawn(function()
    while ScreenGui.Parent do
        updateDisplay()
        task.wait(1)
    end
end)

-- Initial update
updateDisplay()
