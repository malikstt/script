repeat task.wait() until game:IsLoaded()
local lp = game.Players.LocalPlayer
repeat task.wait() until lp:FindFirstChild("PlayerGui")
task.wait(math.random(0,3000)/1000)

local g = lp.PlayerGui:FindFirstChild("ScreenGui")
if g and g:FindFirstChild("DailyRewards") then
    g.DailyRewards:Destroy()
end
getgenv().waitTime = 2.5

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Remote = require(ReplicatedStorage.Shared.Framework.Network.Remote)
local PhysicalItem = require(ReplicatedStorage.Client.Effects.PhysicalItem)
local LocalDataModule = require(ReplicatedStorage.Client.Framework.Services.LocalData)

function getLocalData()
    return LocalDataModule:Get()
end

getgenv().oldGift = getgenv().oldGift or PhysicalItem.Gift
PhysicalItem.Gift = function(giftId, giftType, giftPosition)
    if not getgenv().autoGift then return getgenv().oldGift(giftId, giftType, giftPosition) end
    task.spawn(function()
        pcall(function()
            Remote:FireServer("ClaimGift", giftId)
        end)
    end)
    return nil
end

getgenv().autoGift = not getgenv().autoGift

getgenv().popUpConnection = getgenv().popUpConnection or nil
local genericFolder = workspace.Rendered:FindFirstChild("Generic")
if getgenv().autoGift then
    if genericFolder and not popUpConnection then
        popUpConnection = genericFolder.ChildAdded:Connect(function(item)
            if item:IsA("Part") and #item.Name == 36 then item:Destroy() end
        end)
    end
else
    if popUpConnection then popUpConnection:Disconnect() popUpConnection = nil end
end

Remote:FireServer("SetSetting","Item Notifications",false)

if getgenv().autoGift then
    local powerups = getLocalData().Powerups
    local boxes = {}

    local allowedBoxes = {
        ["Admin Mystery Box"] = true,
        ["OG Mystery Box"] = true,
    }

    for name, amount in pairs(powerups) do
        if allowedBoxes[name] and amount > 0 then
            table.insert(boxes, {name = name, amount = amount})
        end
    end

    table.sort(boxes, function(a,b) return a.amount > b.amount end)

    for _,box in ipairs(boxes) do
        while getgenv().autoGift do
            local am = getLocalData().Powerups[box.name] or 0
            if am > 0 then
                Remote:FireServer("UseGift", box.name, (am > 25 and 25 or am))
                task.wait(getgenv().waitTime)
            else
                break
            end
        end
    end
end
