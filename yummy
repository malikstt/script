local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Network = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")
    :WaitForChild("RemoteEvent")

local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)
local PetsModule = require(ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Data"):WaitForChild("Pets"))

local Window = Rayfield:CreateWindow({
    Name = "Silly Hub",
    ConfigurationSaving = {Enabled = true, FolderName = "SillyHub"},
    LoadingTitle = "Silly Hub",
    LoadingSubtitle = "Loading..."
})

local MainTab = Window:CreateTab("Trade", 4483362458)
local PetTab = Window:CreateTab("Pets", 4483362458)

local autoTrade = false
local autoAccept = false
local autoConfirm = false
local autoTradeDelay = 1
local autoConfirmDelay = 1
local targetName = nil

local tradeLoop = false
local acceptLoop = false
local confirmLoop = false

local function StartTradeLoop()
    if tradeLoop then return end
    tradeLoop = true
    task.spawn(function()
        while tradeLoop do
            if autoTrade and targetName then
                local target = Players:FindFirstChild(targetName)
                if target then
                    local args = {"TradeRequest", target}
                    Network:FireServer(unpack(args))
                end
            end
            task.wait(autoTradeDelay)
        end
    end)
end

local function StartAcceptLoop()
    if acceptLoop then return end
    acceptLoop = true
    task.spawn(function()
        while acceptLoop do
            if autoAccept then
                local args = {"TradeAccept"}
                Network:FireServer(unpack(args))
            end
            task.wait(0.5)
        end
    end)
end

local function StartConfirmLoop()
    if confirmLoop then return end
    confirmLoop = true
    task.spawn(function()
        while confirmLoop do
            if autoConfirm then
                local args = {"TradeConfirm"}
                Network:FireServer(unpack(args))
            end
            task.wait(autoConfirmDelay)
        end
    end)
end

MainTab:CreateToggle({
    Name = "Auto Trade",
    CurrentValue = false,
    Callback = function(v)
        autoTrade = v
        if v then
            StartTradeLoop()
        else
            tradeLoop = false
        end
    end
})

MainTab:CreateSlider({
    Name = "Trade Delay",
    Range = {0.5, 10},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = 1,
    Callback = function(v)
        autoTradeDelay = v
    end
})

MainTab:CreateToggle({
    Name = "Auto Accept",
    CurrentValue = false,
    Callback = function(v)
        autoAccept = v
        if v then
            StartAcceptLoop()
        else
            acceptLoop = false
        end
    end
})

MainTab:CreateToggle({
    Name = "Auto Confirm",
    CurrentValue = false,
    Callback = function(v)
        autoConfirm = v
        if v then
            StartConfirmLoop()
        else
            confirmLoop = false
        end
    end
})

MainTab:CreateSlider({
    Name = "Confirm Delay",
    Range = {0.1, 5},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = 1,
    Callback = function(v)
        autoConfirmDelay = v
    end
})

local playerList = {"None"}
for _, p in ipairs(Players:GetPlayers()) do
    if p ~= Players.LocalPlayer then
        table.insert(playerList, p.Name)
    end
end

local Dropdown = MainTab:CreateDropdown({
    Name = "Select Player",
    Options = playerList,
    CurrentOption = "None",
    Callback = function(option)
        local name
        if typeof(option) == "table" then
            name = option[1]
        else
            name = option
        end
        if name == "None" then
            targetName = nil
        else
            targetName = name
        end
    end
})

Players.PlayerAdded:Connect(function(p)
    if p ~= Players.LocalPlayer then
        table.insert(playerList, p.Name)
        Dropdown:Refresh(playerList, true)
    end
end)

Players.PlayerRemoving:Connect(function(p)
    for i, v in ipairs(playerList) do
        if v == p.Name then
            table.remove(playerList, i)
            break
        end
    end
    Dropdown:Refresh(playerList, true)
end)

local petAmount = 10
local petAuto = {Normal = false, Shiny = false, Mythic = false, ShinyMythic = false}
local secretNames = {}

for name, info in pairs(PetsModule) do
    if info.Rarity == "Secret" then
        secretNames[name] = true
    end
end

local function formatPetId(petId)
    local s = tostring(petId)
    if not s:match(":") then
        return s .. ":0"
    end
    return s
end

local function getSecretPets()
    local res = {Normal = {}, Shiny = {}, Mythic = {}, ShinyMythic = {}}
    local data = LocalData:Get()
    if not data or not data.Pets then return res end

    for _, pet in pairs(data.Pets) do
        if secretNames[pet.Name] then
            local v
            if pet.Shiny and pet.Mythic then
                v = "ShinyMythic"
            elseif pet.Shiny then
                v = "Shiny"
            elseif pet.Mythic then
                v = "Mythic"
            else
                v = "Normal"
            end
            table.insert(res[v], pet.Id)
        end
    end
    return res
end

local function addPets(list)
    for i = 1, math.min(petAmount, #list) do
        Network:FireServer("TradeAddPet", formatPetId(list[i]))
        task.wait(0.2)
    end
end

local function startPetLoop(key)
    task.spawn(function()
        while petAuto[key] do
            local pets = getSecretPets()
            local list = pets[key]
            if list and #list > 0 then
                addPets(list)
            end
            task.wait(0.5)
        end
    end)
end

local function addRandomSecrets()
    task.spawn(function()
        local pets = getSecretPets()
        local allPets = {}
        
        for _, variant in pairs(pets) do
            for _, petId in ipairs(variant) do
                table.insert(allPets, petId)
            end
        end
        
        if #allPets == 0 then return end
        
        local added = 0
        local toAdd = math.min(petAmount, #allPets)
        
        for i = 1, toAdd do
            local randomIndex = math.random(1, #allPets)
            Network:FireServer("TradeAddPet", formatPetId(allPets[randomIndex]))
            table.remove(allPets, randomIndex)
            task.wait(0.2)
            added = added + 1
        end
        
        Rayfield:Notify({
            Title = "Random Secrets",
            Content = "Added " .. added .. " random secret pets",
            Duration = 3,
            Image = 4483362458
        })
    end)
end

PetTab:CreateSlider({
    Name = "Pets Per Cycle",
    Range = {1, 30},
    Increment = 1,
    Suffix = "pets",
    CurrentValue = petAmount,
    Callback = function(v)
        petAmount = v
    end
})
PetTab:CreateParagraph({
    Title = "",
    Content = "Auto Add Settings:"
})

for _, key in ipairs({"Normal","Shiny","Mythic","ShinyMythic"}) do
    PetTab:CreateToggle({
        Name = "Auto Add " .. key,
        CurrentValue = false,
        Callback = function(v)
            petAuto[key] = v
            if v then
                startPetLoop(key)
            end
        end
    })
end

PetTab:CreateButton({
    Name = "Add Random Secrets",
    Callback = function()
        addRandomSecrets()
    end
})

updateStats()

task.spawn(function()
    while true do
        task.wait(10)
        if not game:GetService("CoreGui"):FindFirstChild("Rayfield") then break end
        updateStats()
    end
end)

Rayfield:Notify({
    Title = "Silly Hub",
    Content = "Loaded",
    Duration = 3,
    Image = 4483362458
})
