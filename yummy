local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Trade Tool",
    ConfigurationSaving = {Enabled = false}
})

local Tab = Window:CreateTab("Main")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

local TradeEvent = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")
    :WaitForChild("RemoteEvent")

local autoTrade = false
local autoTradeDelay = 1
local autoConfirm = false
local autoConfirmDelay = 1
local targetName = nil

local tradeLoopRunning = false
local confirmLoopRunning = false

local function StartTradeLoop()
    if tradeLoopRunning then return end
    tradeLoopRunning = true
    task.spawn(function()
        while tradeLoopRunning do
            if autoTrade and targetName then
                local target = Players:WaitForChild(targetName)
                local args = {
                    "TradeRequest",
                    target
                }
                TradeEvent:FireServer(unpack(args))
            end
            task.wait(autoTradeDelay)
        end
    end)
end

local function StartConfirmLoop()
    if confirmLoopRunning then return end
    confirmLoopRunning = true
    task.spawn(function()
        while confirmLoopRunning do
            if autoConfirm then
                local args = {
                    "TradeConfirm"
                }
                TradeEvent:FireServer(unpack(args))
            end
            task.wait(autoConfirmDelay)
        end
    end)
end

Tab:CreateToggle({
    Name = "Auto Trade",
    CurrentValue = false,
    Callback = function(v)
        autoTrade = v
        if v then
            StartTradeLoop()
        else
            tradeLoopRunning = false
        end
    end
})

Tab:CreateSlider({
    Name = "Trade Delay",
    Range = {0.1, 10},
    Increment = 0.1,
    CurrentValue = 1,
    Callback = function(v)
        autoTradeDelay = v
    end
})

Tab:CreateToggle({
    Name = "Auto Confirm",
    CurrentValue = false,
    Callback = function(v)
        autoConfirm = v
        if v then
            StartConfirmLoop()
        else
            confirmLoopRunning = false
        end
    end
})

Tab:CreateSlider({
    Name = "Confirm Delay",
    Range = {0.1, 10},
    Increment = 0.1,
    CurrentValue = 1,
    Callback = function(v)
        autoConfirmDelay = v
    end
})

local playerList = {"None"}
for _, p in ipairs(Players:GetPlayers()) do
    if p ~= Players.LocalPlayer then
        table.insert(playerList, p.Name)
    end
end

local Dropdown = Tab:CreateDropdown({
    Name = "Select Player",
    Options = playerList,
    CurrentOption = "None",
    Callback = function(option)
        local name

        if typeof(option) == "table" then
            name = option[1]
        else
            name = option
        end

        if name == "None" then
            targetName = nil
        else
            targetName = name
        end
    end
})

Players.PlayerAdded:Connect(function(p)
    if p ~= Players.LocalPlayer then
        table.insert(playerList, p.Name)
        Dropdown:Refresh(playerList, true)
    end
end)

Players.PlayerRemoving:Connect(function(p)
    for i, v in ipairs(playerList) do
        if v == p.Name then
            table.remove(playerList, i)
            break
        end
    end
    Dropdown:Refresh(playerList, true)
end)
