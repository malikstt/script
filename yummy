local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Trade Tool",
    ConfigurationSaving = {Enabled = false}
})

local Tab = Window:CreateTab("Main")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

local TradeEvent = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")
    :WaitForChild("RemoteEvent")

local LocalData = require(
    ReplicatedStorage
        :WaitForChild("Client")
        :WaitForChild("Framework")
        :WaitForChild("Services")
        :WaitForChild("LocalData")
)

local autoTrade = false
local autoTradeDelay = 1
local autoConfirm = false
local autoConfirmDelay = 1
local targetName = nil

local tradeLoopRunning = false
local confirmLoopRunning = false

local function StartTradeLoop()
    if tradeLoopRunning then return end
    tradeLoopRunning = true
    task.spawn(function()
        while tradeLoopRunning do
            if autoTrade and targetName then
                local target = Players:FindFirstChild(targetName)
                if target then
                    TradeEvent:FireServer("TradeRequest", target)
                end
            end
            task.wait(autoTradeDelay)
        end
    end)
end

local function StartConfirmLoop()
    if confirmLoopRunning then return end
    confirmLoopRunning = true
    task.spawn(function()
        while confirmLoopRunning do
            if autoConfirm then
                TradeEvent:FireServer("TradeConfirm")
            end
            task.wait(autoConfirmDelay)
        end
    end)
end

Tab:CreateToggle({
    Name = "Auto Trade",
    CurrentValue = false,
    Callback = function(v)
        autoTrade = v
        if v then
            StartTradeLoop()
        end
        if not v then
            tradeLoopRunning = false
        end
    end
})

Tab:CreateSlider({
    Name = "Trade Delay",
    Range = {0.1, 10},
    Increment = 0.1,
    CurrentValue = 1,
    Callback = function(v)
        autoTradeDelay = v
    end
})

Tab:CreateToggle({
    Name = "Auto Confirm",
    CurrentValue = false,
    Callback = function(v)
        autoConfirm = v
        if v then
            StartConfirmLoop()
        end
        if not v then
            confirmLoopRunning = false
        end
    end
})

Tab:CreateSlider({
    Name = "Confirm Delay",
    Range = {0.1, 10},
    Increment = 0.1,
    CurrentValue = 1,
    Callback = function(v)
        autoConfirmDelay = v
    end
})

local playerList = {"None"}
for _, p in ipairs(Players:GetPlayers()) do
    if p ~= Players.LocalPlayer then
        table.insert(playerList, p.Name)
    end
end

local Dropdown = Tab:CreateDropdown({
    Name = "Select Player",
    Options = playerList,
    CurrentOption = "None",
    Callback = function(option)
        if option == "None" then
            targetName = nil
        else
            targetName = option
        end
    end
})

Players.PlayerAdded:Connect(function(p)
    if p ~= Players.LocalPlayer then
        table.insert(playerList, p.Name)
        Dropdown:Refresh(playerList, true)
    end
end)

Players.PlayerRemoving:Connect(function(p)
    for i, v in ipairs(playerList) do
        if v == p.Name then
            table.remove(playerList, i)
            break
        end
    end
    Dropdown:Refresh(playerList, true)
end)

local function addPets(t)
    local data = LocalData:Get()
    if not data or not data.Pets then return end

    local list = {}

    for _, pet in pairs(data.Pets) do
        local s = pet.Shiny
        local m = pet.Mythic

        if t == "normal" and not s and not m then
            table.insert(list, pet)
        elseif t == "mythic" and m and not s then
            table.insert(list, pet)
        elseif t == "shiny" and s and not m then
            table.insert(list, pet)
        elseif t == "shinymythic" and s and m then
            table.insert(list, pet)
        elseif t == "any" then
            table.insert(list, pet)
        end
    end

    for i = 1, math.min(10, #list) do
        local id = tostring(list[i].Id)
        if not id:match(":") then
            id = id .. ":0"
        end
        TradeEvent:FireServer("TradeAddPet", id)
        task.wait(0.1)
    end
end

Tab:CreateButton({
    Name = "Add 10 Normal",
    Callback = function()
        task.spawn(function()
            addPets("normal")
        end)
    end
})

Tab:CreateButton({
    Name = "Add 10 Mythic",
    Callback = function()
        task.spawn(function()
            addPets("mythic")
        end)
    end
})

Tab:CreateButton({
    Name = "Add 10 Shiny",
    Callback = function()
        task.spawn(function()
            addPets("shiny")
        end)
    end
})

Tab:CreateButton({
    Name = "Add 10 Shiny Mythic",
    Callback = function()
        task.spawn(function()
            addPets("shinymythic")
        end)
    end
})

Tab:CreateButton({
    Name = "Add 10 Any",
    Callback = function()
        task.spawn(function()
            addPets("any")
        end)
    end
})
