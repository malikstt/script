local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
	Name = "TP / Click / Noclip",
	LoadingTitle = "Rayfield",
	LoadingSubtitle = "Toggle",
	ConfigurationSaving = {Enabled = false}
})

local Tab = Window:CreateTab("Main", 4483362458)

local excluded = "malikstom"

local delayScale = 0.5
local spamClick = false
local tpSequential = false
local tpRandom = false
local noclip = false

local selectedNames = {}
local seqIndex = 1
local seqTarget = nil

local clickConn
local seqConn
local randThread
local noclipConn

local function getAllNames()
	local names = {}
	for _,p in ipairs(Players:GetPlayers()) do
		if p ~= LocalPlayer and p.Name ~= excluded then
			table.insert(names, p.Name)
		end
	end
	table.sort(names,function(a,b)
		return a:lower() < b:lower()
	end)
	return names
end

local function getSelectedPlayers()
	local t = {}
	for _,p in ipairs(Players:GetPlayers()) do
		if table.find(selectedNames, p.Name)
		and p.Character
		and p.Character:FindFirstChild("Humanoid")
		and p.Character.Humanoid.Health > 0 then
			table.insert(t,p)
		end
	end
	table.sort(t,function(a,b)
		return a.Name:lower() < b.Name:lower()
	end)
	return t
end

local function tpTo(plr)
	local c = LocalPlayer.Character
	local tc = plr.Character
	if not c or not tc then return end
	local hrp = c:FindFirstChild("HumanoidRootPart")
	local thrp = tc:FindFirstChild("HumanoidRootPart")
	if not hrp or not thrp then return end
	task.wait(delayScale)
	hrp.CFrame = thrp.CFrame * CFrame.new(0,0,-0.5)
end

Tab:CreateSlider({
	Name = "TP Delay",
	Range = {0, 2},
	Increment = 0.05,
	Suffix = "sec",
	CurrentValue = 0.5,
	Callback = function(v)
		delayScale = v
	end
})

Tab:CreateDropdown({
	Name = "Select Players (Alphabetical)",
	Options = getAllNames(),
	CurrentOption = {},
	MultipleOptions = true,
	Callback = function(v)
		selectedNames = v
	end
})

Tab:CreateToggle({
	Name = "Virtual Spam Click",
	CurrentValue = false,
	Callback = function(v)
		spamClick = v
		if v then
			clickConn = RunService.Heartbeat:Connect(function()
				VirtualUser:Button1Down(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
				VirtualUser:Button1Up(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
			end)
		else
			if clickConn then clickConn:Disconnect() clickConn = nil end
		end
	end
})

Tab:CreateToggle({
	Name = "TP Selected Players (Sequential)",
	CurrentValue = false,
	Callback = function(v)
		tpSequential = v
		seqIndex = 1
		seqTarget = nil

		if v then
			seqConn = RunService.Heartbeat:Connect(function()
				local list = getSelectedPlayers()
				if #list == 0 then return end

				if not seqTarget
				or not seqTarget.Character
				or seqTarget.Character.Humanoid.Health <= 0 then
					seqTarget = list[seqIndex]
					seqIndex += 1
					if seqIndex > #list then seqIndex = 1 end
				end

				if seqTarget then
					tpTo(seqTarget)
				end
			end)
		else
			if seqConn then seqConn:Disconnect() seqConn = nil end
		end
	end
})

Tab:CreateToggle({
	Name = "TP Random Selected Player",
	CurrentValue = false,
	Callback = function(v)
		tpRandom = v
		if v then
			randThread = task.spawn(function()
				while tpRandom do
					local list = getSelectedPlayers()
					if #list > 0 then
						tpTo(list[math.random(#list)])
					end
					task.wait(delayScale)
				end
			end)
		else
			tpRandom = false
		end
	end
})

Tab:CreateToggle({
	Name = "Noclip",
	CurrentValue = false,
	Callback = function(v)
		noclip = v
		if v then
			noclipConn = RunService.Stepped:Connect(function()
				if LocalPlayer.Character then
					for _,part in ipairs(LocalPlayer.Character:GetDescendants()) do
						if part:IsA("BasePart") then
							part.CanCollide = false
						end
					end
				end
			end)
		else
			if noclipConn then
				noclipConn:Disconnect()
				noclipConn = nil
			end
		end
	end
})
