local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local VirtualUser = game:GetService("VirtualUser")

local LocalPlayer = Players.LocalPlayer
local ItemsModule = require(ReplicatedStorage:WaitForChild("Modules"):WaitForChild("Items"))

local GetAssets = ReplicatedStorage:WaitForChild("Events"):WaitForChild("Misc"):WaitForChild("GetAssets")

local HIGH_VALUE_THRESHOLD = 1500
local HIGH_VALUE_WEBHOOK = "https://discord.com/api/webhooks/1473934078087528509/V3Bm-RyTV4mlClC5TKQn9gH6BK-ooqsssPw9P13_egipjWwjGoEOAn_7pbfA3TdAIL75"

LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    task.wait(0.1)
    VirtualUser:ClickButton2(Vector2.new(0,0))
end)

local Events = ReplicatedStorage:WaitForChild("Events")
local RNG = Events:WaitForChild("RNG")
local Roll = RNG:WaitForChild("Roll")

local rolledIDs = {}
local highValueItems = {}

local function postWebhook(url, data)
    request({
        Url = url,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode(data)
    })
end

local function sendHighValueSummary()
    if #highValueItems == 0 then return end

    local description = ""
    for _, item in ipairs(highValueItems) do
        description = description .. "Item: " .. (item.Name or "Unknown") .. "\nPrice: $" .. tostring(item.Price or 0) .. "\nSerial: " .. (item.Serial or "N/A") .. "\n\n"
    end

    local data = {
        username = "High Value Summary",
        embeds = {{
            title = LocalPlayer.Name .. " HIGH VALUE LIMITED ITEMS",
            description = description,
            color = 0xff0000
        }}
    }
    postWebhook(HIGH_VALUE_WEBHOOK, data)
end

local success, assets = pcall(function()
    return GetAssets:InvokeServer()
end)

if success and assets then
    for _, itemInfo in pairs(assets) do
        local itemID = tostring(itemInfo.ID or itemInfo.Id or itemInfo.id)
        local serial = itemInfo.Serials or itemInfo.Serial or itemInfo.serial
        local itemData = ItemsModule[itemID]
        if itemData then
            local price = itemData.Price or itemData.Cost or itemData.Value or 0
            if price >= HIGH_VALUE_THRESHOLD and itemData.Rarity == "Limited" then
                table.insert(highValueItems, {
                    Name = itemData.Name,
                    Price = price,
                    Serial = serial or "N/A"
                })
            end
        end
    end
end

sendHighValueSummary()

task.spawn(function()
    while true do
        task.wait(4)
        local successRoll, result = pcall(function()
            return Roll:InvokeServer()
        end)

        if successRoll and result then
            local itemID
            local serial
            if type(result) == "table" then
                itemID = tostring(result.ID or result.Id or result.id)
                serial = result.Serials or result.Serial or result.serial
            else
                itemID = tostring(result)
            end

            if itemID then
                local itemData = ItemsModule[itemID]
                if itemData then
                    print("Rolled:", itemData.Name or "Unknown", "| Rarity:", itemData.Rarity or "Unknown", "| Price:", itemData.Price or itemData.Value or 0, "| Serial:", serial or "N/A")

                    local price = itemData.Price or itemData.Cost or itemData.Value or 0
                    local uniqueKey = serial and (itemID .. "_" .. tostring(serial)) or itemID

                    if price >= HIGH_VALUE_THRESHOLD and itemData.Rarity == "Limited" and not rolledIDs[uniqueKey] then
                        rolledIDs[uniqueKey] = true
                        table.insert(highValueItems, {
                            Name = itemData.Name,
                            Price = price,
                            Serial = serial or "N/A"
                        })
                        sendHighValueSummary()
                    end
                end
            end
        end
    end
end)
