repeat task.wait() until game:IsLoaded()
local lp = game.Players.LocalPlayer
repeat task.wait() until lp:FindFirstChild("PlayerGui")
task.wait(math.random(0,3000)/1000)

local g = lp.PlayerGui:FindFirstChild("ScreenGui")
if g and g:FindFirstChild("DailyRewards") then
    g.DailyRewards:Destroy()
end

-- LOAD UI / CONFIG FIRST (NO task.spawn)
loadstring(game:HttpGet("https://raw.githubusercontent.com/IdiotHub/Scripts/main/Loader"))()

-- WAIT FOR LOADER TO SETTLE
task.wait(5)

-- NOW START AUTOMATION
task.spawn(function()
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Remote = require(ReplicatedStorage.Shared.Framework.Network.Remote)
    local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

    local function data()
        return LocalData:Get()
    end

    while true do
        local powerups = data().Powerups or {}

        local boxes = {}
        for name, amount in pairs(powerups) do
            if amount > 0 and name:find("Box") and name ~= "Mystery Box" then
                print("Found box:", name, amount)
                table.insert(boxes, name)
            end
        end

        local tickets = powerups["Neon Spin Ticket"] or 0
        local keys = powerups["Ringmaster Key"] or 0

        print("Found Neon Spin Tickets:", tickets)
        print("Found Ringmaster Keys:", keys)

        if tickets > 0 then
            while (data().Powerups["Neon Spin Ticket"] or 0) > 0 do
                Remote:InvokeServer("NeonWheelSpin")
                task.wait(1)
                Remote:FireServer("ClaimNeonWheelSpinQueue")
                task.wait(1)
            end

        elseif keys > 0 then
            while (data().Powerups["Ringmaster Key"] or 0) > 0 do
                print("Opening Chest [x" .. data().Powerups["Ringmaster Key"] .. " Keys]")
                Remote:FireServer("UnlockEventChest", "Circus Chest", false)
                task.wait(1)
            end

        elseif #boxes > 0 then
            for _, box in ipairs(boxes) do
                while (data().Powerups[box] or 0) > 0 do
                    local amt = math.min(data().Powerups[box], 50)
                    print("Opening Box:", box, "x" .. amt)
                    Remote:FireServer("UseGift", box, amt)
                    task.wait(1)
                end
            end
        end

        task.wait(60)
    end
end)
