_G.Config={UserID="3087df52-2f5c-4e6f-a407-10fa72d16932",discord_id="1135837863603351573",Note="Pc"}
getgenv().waitTime = 2.5
getgenv().TARGET_OPENS = 1000
getgenv().GEM_LIMIT = 4000000000
getgenv().running = true

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")

local Remote = require(ReplicatedStorage.Shared.Framework.Network.Remote)
local PhysicalItem = require(ReplicatedStorage.Client.Effects.PhysicalItem)
local LocalDataModule = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local RE = ReplicatedStorage
    :WaitForChild("Shared")
    :WaitForChild("Framework")
    :WaitForChild("Network")
    :WaitForChild("Remote")
    :WaitForChild("RemoteEvent")

local POTION_NAME = "2026 Elixir"

local function getLocalData()
    return LocalDataModule:Get()
end

local function pressB()
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.B, false, game)
    task.wait(0.02)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.B, false, game)
end

getgenv().oldGift = getgenv().oldGift or PhysicalItem.Gift
PhysicalItem.Gift = function(giftId, giftType, giftPosition)
    if not getgenv().autoGift then
        return getgenv().oldGift(giftId, giftType, giftPosition)
    end
    task.spawn(function()
        Remote:FireServer("ClaimGift", giftId)
    end)
end

getgenv().autoGift = true
Remote:FireServer("SetSetting","Item Notifications",false)

local function getAnyMysteryBox()
    local data = getLocalData()
    if not data or not data.Powerups then return nil, 0 end
    for name, amount in pairs(data.Powerups) do
        if type(name) == "string" and name:find("Mystery Box") and amount > 0 then
            return name, amount
        end
    end
    return nil, 0
end

local opened = 0
local reachedGems = false
local ranOutBoxes = false

task.spawn(function()
    while getgenv().autoGift and opened < getgenv().TARGET_OPENS do
        pressB()
        task.wait(5)
    end
end)

while getgenv().autoGift and opened < getgenv().TARGET_OPENS do
    local d = getLocalData()

    if d and d.Gems and d.Gems >= getgenv().GEM_LIMIT then
        reachedGems = true
        print("4B GEMS REACHED")
        break
    end

    local boxName, boxAmount = getAnyMysteryBox()
    if not boxName or boxAmount <= 0 then
        ranOutBoxes = true
        print("0 MYSTERY BOX FOUND")
        break
    end

    local remaining = getgenv().TARGET_OPENS - opened
    local useAmount = math.min(50, boxAmount, remaining)

    Remote:FireServer("UseGift", boxName, useAmount)
    opened += useAmount

    task.wait(getgenv().waitTime)
end

getgenv().autoGift = false
print("STARTING POTION USE")

local function getPotionAmount()
    local d = getLocalData()
    if not d or not d.Potions then return 0 end
    for _, pot in pairs(d.Potions) do
        if type(pot) == "table" and pot.Name == POTION_NAME then
            return pot.Amount or 0
        end
    end
    return 0
end

local usedAnyPotion = false

while getgenv().running do
    local before = getPotionAmount()
    if before <= 0 then
        print("0 POTION FOUND")
        break
    end

    local use = before >= 10 and 10 or 1
    RE:FireServer("UsePotion", POTION_NAME, use)

    task.wait(0.4)

    local after = getPotionAmount()
    if after < before then
        usedAnyPotion = true
        print("USED", use, "LEFT", after)
    end

    if after <= 0 then
        break
    end
end

print("SCRIPT JOB IS DONE!")
