local AUTO_DELETE = true
if not AUTO_DELETE then return end

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Network = ReplicatedStorage.Shared.Framework.Network.Remote.RemoteEvent
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)
local PetsModule = require(ReplicatedStorage.Shared.Data.Pets)
local Workspace = game:GetService("Workspace")

-- Disable 3D Rendering, remove textures and meshes
Workspace.DescendantAdded:Connect(function(descendant)
    if descendant:IsA("BasePart") then
        descendant.Transparency = 1
        descendant.CanCollide = false
        descendant.CastShadow = false
        descendant.Material = Enum.Material.SmoothPlastic
        descendant:ClearAllChildren()
    elseif descendant:IsA("Texture") or descendant:IsA("Mesh") then
        descendant:Destroy()
    elseif descendant:IsA("SpecialMesh") then
        descendant:Destroy()
    end
end)

-- Also apply to existing descendants
for _, descendant in ipairs(Workspace:GetDescendants()) do
    if descendant:IsA("BasePart") then
        descendant.Transparency = 1
        descendant.CanCollide = false
        descendant.CastShadow = false
        descendant.Material = Enum.Material.SmoothPlastic
        descendant:ClearAllChildren()
    elseif descendant:IsA("Texture") or descendant:IsA("Mesh") then
        descendant:Destroy()
    elseif descendant:IsA("SpecialMesh") then
        descendant:Destroy()
    end
end

local DELETE_AMOUNTS = {100000, 10000, 1000, 10, 1}

local function getTeamPetIds()
    local ids = {}
    local data = LocalData:Get()
    if not data then return ids end
    local teamIndex = data.TeamEquipped
    if not teamIndex then return ids end
    local team = data.Teams and data.Teams[teamIndex]
    if not team or not team.Pets then return ids end
    for _, id in ipairs(team.Pets) do
        ids[id] = true
    end
    return ids
end

task.spawn(function()
    while true do
        local data = LocalData:Get()
        if data and data.Pets then
            local teamSet = getTeamPetIds()
            for _, pet in ipairs(data.Pets) do
                if pet.Id and not teamSet[pet.Id] then
                    local info = PetsModule[pet.Name]
                    if info then
                        local rarity = info.Rarity
                        local tier = info.Tier

                        if rarity ~= "Secret" and rarity == "Legendary" and (tier == 1 or tier == 2 or tier == 3) then
                            for _, amount in ipairs(DELETE_AMOUNTS) do
                                Network:FireServer("DeletePet", pet.Id, amount, false)
                                task.wait(0.02)
                            end
                        end
                    end
                end
            end
        end
        task.wait(0.5)
    end
end)
