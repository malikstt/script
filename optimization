-- TS
local args = {
    "SetSetting",
    "Debug",
    false
}
game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Framework"):WaitForChild("Network"):WaitForChild("Remote"):WaitForChild("RemoteEvent"):FireServer(unpack(args))

-- Toggle for the whole script
getgenv().running = true
getgenv().waitTime = 2

local RS = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local Remote = require(RS.Shared.Framework.Network.Remote)
local RE = RS:WaitForChild("Shared")
             :WaitForChild("Framework")
             :WaitForChild("Network")
             :WaitForChild("Remote")
             :WaitForChild("RemoteEvent")
local LocalData = require(RS.Client.Framework.Services.LocalData)

local pots = {
    {"UsePotion", "Speed", 7, 10},
    {"UsePotion", "Lucky", 7, 10},
    {"UsePotion", "Mythic", 7, 10},
    {"UsePotion", "Egg Elixir", 1, 10},    
    {"UsePotion", "Infinity Elixir", 1, 10},       
    {"UsePotion", "Festive Elixir", 4, 10},
    {"UsePotion", "Festive Infinity Elixir", 1, 10},
    {"UsePotion", "Ultra Infinity Elixir", 1,10},
}

local function data()
    return LocalData:Get()
end

RunService:BindToRenderStep("AutoFarmTask", Enum.RenderPriority.First.Value, function()
    if not getgenv().running then return end

    local powerups = data().Powerups or {}

    -- AUTO TICKETS
    for name, amount in pairs(powerups) do
        if amount > 0 and name:find("Ticket") then
            local before = amount
            local remoteName = name:gsub(" Ticket", "").."WheelSpin"
            pcall(function()
                Remote:InvokeServer(remoteName)
                task.wait(1)
                Remote:FireServer("ClaimNeonWheelSpinQueue")
            end)
            task.wait(getgenv().waitTime)
        end
    end

    -- AUTO KEYS
    for name, amount in pairs(powerups) do
        if amount > 0 and name:find("Key") then
            pcall(function()
                Remote:FireServer("UnlockEventChest", name:gsub(" Key", "") .. " Chest", false)
            end)
            task.wait(getgenv().waitTime)
        end
    end

    -- AUTO POTIONS
    local iterations = 60
    for _ = 1, iterations do
        for _, args in ipairs(pots) do
            pcall(function()
                RE:FireServer(unpack(args))
            end)
        end
    end
end)
