local Network = require(game:GetService("ReplicatedStorage").Modules.Network)
local player = game.Players.LocalPlayer

local WAIT_TIME = 5
local lastItemAddedTime = 0
local tradeStatus = false
local isReady = false

-- Track trade item additions (both pets and tokens)
Network:BindEvents({
    ["TradeRequest"] = function(sender)
        Network:FireServer("AcceptTrade", sender)
    end
})

Network:BindEvents({
    ["AddTradeItem"] = function(itemData)
        if tradeStatus then
            lastItemAddedTime = tick()  -- Update time when an item is added (either pet or token)
            isReady = false  -- Reset isReady to ensure we don't ready up too soon
        end
    end,

    ["RemoveTradeItem"] = function(itemData)
        if tradeStatus then
            lastItemAddedTime = tick()  -- Update time when an item is removed
            isReady = false  -- Reset isReady to ensure we don't ready up too soon
        end
    end
})

local function shouldReadyUp()
    local timeSinceLastItem = tick() - lastItemAddedTime
    return timeSinceLastItem >= WAIT_TIME and not isReady
end

player.PlayerGui.Trading:GetPropertyChangedSignal("Enabled"):Connect(function()
    if player.PlayerGui.Trading.Enabled then
        tradeStatus = true
    else
        tradeStatus = false
    end
end)

local function checkTradeStatus()
    if tradeStatus and shouldReadyUp() then
        -- Ready up when the time since the last item (pet or token) is greater than WAIT_TIME
        Network:FireServer("ReadyUp", false, true)
        isReady = true
    end
end

while true do
    task.wait(1)  -- Run every second to check trade status
    if tradeStatus then
        checkTradeStatus()
    end
end
