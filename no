local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Auto Auction System",
    LoadingTitle = "Auto Auction",
    LoadingSubtitle = "by YourName",
    ConfigurationSaving = {
       Enabled = true,
       FolderName = "AutoAuctionConfig",
       FileName = "Config"
    },
    Discord = {
       Enabled = false,
       Invite = "noinvitelink",
       RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
       Title = "Untitled",
       Subtitle = "Key System",
       Note = "No method of obtaining the key is provided",
       FileName = "Key",
       SaveKey = true,
       GrabKeyFromSite = false,
       Key = {"Hello"}
    }
})

-- Main Tab
local MainTab = Window:CreateTab("Main", 4483362458)

-- Auto Auction Toggle
local AutoAuctionToggle = MainTab:CreateToggle({
    Name = "Enable Auto Auction",
    CurrentValue = false,
    Flag = "AutoAuctionEnabled",
    Callback = function(Value)
        getgenv().AutoAuctionEnabled = Value
    end,
})

-- Delay Slider
local DelaySlider = MainTab:CreateSlider({
    Name = "Bid Delay (seconds)",
    Range = {0.1, 3},
    Increment = 0.1,
    Suffix = "s",
    CurrentValue = 0.5,
    Flag = "BidDelay",
    Callback = function(Value)
        getgenv().BidDelay = Value
    end,
})

-- Auction Selection
local AuctionDropdown = MainTab:CreateDropdown({
    Name = "Target Auction",
    Options = {
        "Best Available", -- Will join any available auction
        "Auction 1",
        "Auction 2", 
        "Auction 3",
        "Auction 4",
        "Auction 5",
        "Auction 6",
        "Auction 7",
        "Auction 8",
        "Auction 9",
        "Auction 10"
    },
    CurrentOption = "Best Available",
    MultipleOptions = false,
    Flag = "TargetAuction",
    Callback = function(Option)
        getgenv().TargetAuction = Option
    end,
})

-- Bid Settings Tab
local BidTab = Window:CreateTab("Bid Settings", 4483362458)

-- Bid Range
local MinBidSlider = BidTab:CreateSlider({
    Name = "Minimum Bid",
    Range = {100, 100000},
    Increment = 100,
    Suffix = "",
    CurrentValue = 1000,
    Flag = "MinBid",
    Callback = function(Value)
        getgenv().MinBid = Value
    end,
})

local MaxBidSlider = BidTab:CreateSlider({
    Name = "Maximum Bid",
    Range = {1000, 1000000},
    Increment = 1000,
    Suffix = "",
    CurrentValue = 50000,
    Flag = "MaxBid",
    Callback = function(Value)
        getgenv().MaxBid = Value
    end,
})

-- Bid Percentage Settings
local BidPercentageSlider = BidTab:CreateSlider({
    Name = "Max Bid Percentage",
    Info = "Maximum percentage of money to bid",
    Range = {1, 100},
    Increment = 1,
    Suffix = "%",
    CurrentValue = 50,
    Flag = "MaxBidPercentage",
    Callback = function(Value)
        getgenv().MaxBidPercentage = Value
    end,
})

-- Safe Detection Tab
local SafeTab = Window:CreateTab("Safe Detection", 4483362458)

-- Safe Toggle
local SkipNoSafeToggle = SafeTab:CreateToggle({
    Name = "Skip if No Safe Found",
    CurrentValue = false,
    Flag = "SkipNoSafe",
    Callback = function(Value)
        getgenv().SkipNoSafe = Value
    end,
})

-- Safe List Display
local SafeList = SafeTab:CreateLabel("Current Garage Safes: None")
getgenv().SafeListLabel = SafeList

-- Safe Detection Toggle
local SafeDetectionToggle = SafeTab:CreateToggle({
    Name = "Enable Safe Detection",
    CurrentValue = true,
    Flag = "SafeDetectionEnabled",
    Callback = function(Value)
        getgenv().SafeDetectionEnabled = Value
    end,
})

-- Target Safes Selection
local TargetSafesDropdown = SafeTab:CreateDropdown({
    Name = "Target Safes",
    Options = {
        "Balloon Safe",
        "Robot Safe", 
        "Pet Safe",
        "Alien Safe",
        "Money Safe",
        "Pink Sakura Safe",
        "Hacker Safe",
        "Demon Safe",
        "Wizard Safe",
        "Angelic Safe",
        "Cake Safe"
    },
    CurrentOption = {},
    MultipleOptions = true,
    Flag = "TargetSafes",
    Callback = function(Options)
        getgenv().TargetSafes = Options
    end,
})

-- Garage Display Tab
local GarageTab = Window:CreateTab("Garage Display", 4483362458)

-- Current Garage Display
local CurrentGarageLabel = GarageTab:CreateLabel("Current Garage: None")
getgenv().GarageLabel = CurrentGarageLabel

-- Items Display
local ItemsList = GarageTab:CreateLabel("Current Items:")
getgenv().ItemsLabel = ItemsList

-- Garage Counter
local GarageCounterLabel = GarageTab:CreateLabel("Garages Completed: 0/3")
getgenv().CounterLabel = GarageCounterLabel

-- Auto Leave Toggle
local AutoLeaveToggle = GarageTab:CreateToggle({
    Name = "Auto Leave After 3 Garages",
    CurrentValue = true,
    Flag = "AutoLeave",
    Callback = function(Value)
        getgenv().AutoLeave = Value
    end,
})

-- Control Tab
local ControlTab = Window:CreateTab("Controls", 4483362458)

-- Join Auction Button
local JoinButton = ControlTab:CreateButton({
    Name = "Join Best Available Auction",
    Callback = function()
        -- This will be connected to your join function
        if getgenv().JoinAuction then
            getgenv().JoinAuction()
        end
    end,
})

-- Skip Current Button
local SkipButton = ControlTab:CreateButton({
    Name = "Skip Current Auction",
    Callback = function()
        -- This will fire the skip remote
        if game:GetService("ReplicatedStorage"):FindFirstChild("Events") then
            local Auctions = game:GetService("ReplicatedStorage").Events.Auctions
            if Auctions:FindFirstChild("PassLocal") then
                Auctions.PassLocal:Fire()
            end
        end
    end,
})

-- Reset Counter Button
local ResetButton = ControlTab:CreateButton({
    Name = "Reset Garage Counter",
    Callback = function()
        if getgenv().CounterLabel then
            getgenv().CounterLabel:Set("Garages Completed: 0/3")
            getgenv().garageCount = 0
        end
    end,
})

-- Status Display
local StatusLabel = ControlTab:CreateLabel("Status: Idle")
getgenv().StatusLabel = StatusLabel

-- Initialize global variables
getgenv().AutoAuctionEnabled = false
getgenv().BidDelay = 0.5
getgenv().TargetAuction = "Best Available"
getgenv().MinBid = 1000
getgenv().MaxBid = 50000
getgenv().MaxBidPercentage = 50
getgenv().SkipNoSafe = false
getgenv().SafeDetectionEnabled = true
getgenv().TargetSafes = {}
getgenv().AutoLeave = true
getgenv().garageCount = 0
getgenv().currentGarageItems = {}
getgenv().foundSafes = {}

-- Update function for garage display (to be called from your script)
function updateGarageDisplay(garageNumber, items, safesFound)
    if getgenv().GarageLabel then
        getgenv().GarageLabel:Set("Current Garage: " .. (garageNumber or "None"))
    end
    
    if getgenv().ItemsLabel then
        local itemText = "Current Items:\n"
        if items and #items > 0 then
            for i, item in ipairs(items) do
                itemText = itemText .. "- " .. item .. "\n"
            end
        else
            itemText = itemText .. "No items detected"
        end
        getgenv().ItemsLabel:Set(itemText)
    end
    
    if getgenv().SafeListLabel then
        local safeText = "Current Garage Safes: "
        if safesFound and #safesFound > 0 then
            safeText = safeText .. table.concat(safesFound, ", ")
        else
            safeText = safeText .. "None"
        end
        getgenv().SafeListLabel:Set(safeText)
    end
    
    if getgenv().CounterLabel then
        getgenv().CounterLabel:Set("Garages Completed: " .. (getgenv().garageCount or 0) .. "/3")
    end
end

-- Function to check for specific safes
function checkForTargetSafes(items)
    local foundSafes = {}
    local targetSafes = getgenv().TargetSafes or {}
    
    if not getgenv().SafeDetectionEnabled then return foundSafes end
    
    for _, item in ipairs(items) do
        for _, targetSafe in ipairs(targetSafes) do
            if string.find(string.lower(item), string.lower(targetSafe)) then
                table.insert(foundSafes, targetSafe)
            end
        end
    end
    
    return foundSafes
end

-- Function to handle garage completion
function onGarageCompleted()
    getgenv().garageCount = (getgenv().garageCount or 0) + 1
    updateGarageDisplay(nil, {}, {})
    
    -- Check if should auto leave
    if getgenv().AutoLeave and getgenv().garageCount >= 3 then
        if getgenv().StatusLabel then
            getgenv().StatusLabel:Set("Status: Leaving - 3 garages completed")
        end
        
        -- Fire skip remote to leave auction
        if game:GetService("ReplicatedStorage"):FindFirstChild("Events") then
            local Auctions = game:GetService("ReplicatedStorage").Events.Auctions
            if Auctions:FindFirstChild("PassLocal") then
                Auctions.PassLocal:Fire()
            end
        end
        
        getgenv().garageCount = 0
    end
end

-- Connect to game events (this part would be in your actual script)
-- You would hook into the SetupAuction event to detect items
-- and into EndAuction to increment garage counter

Rayfield:LoadConfiguration()
