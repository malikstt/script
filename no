local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local RNGFolder = ReplicatedStorage:WaitForChild("Events"):WaitForChild("RNG")
local GetUpgrades = RNGFolder:WaitForChild("GetHalloweenUpgrades") -- still server-side remote, trust me
local UpgradeData = require(ReplicatedStorage:WaitForChild("Modules"):WaitForChild("HalloweenRNGUpgrades"))

-- Use Valentine naming
local upgradeOrder = {"HeartsMultiplier","Luck","FasterRoll","AutoRoll","ValentinesSafeChance"}

local gui = Instance.new("ScreenGui")
gui.Name = "ValentineDashboard"
gui.Parent = player:WaitForChild("PlayerGui")
gui.ResetOnSpawn = false

-- Full screen transparent background
local background = Instance.new("Frame")
background.Size = UDim2.fromScale(1,1)
background.BackgroundColor3 = Color3.fromRGB(0,0,0)
background.BackgroundTransparency = 0.4
background.Parent = gui

local container = Instance.new("Frame")
container.Size = UDim2.fromScale(0.6,0.75)
container.Position = UDim2.fromScale(0.2,0.125)
container.BackgroundTransparency = 1
container.Parent = background

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0,12)
layout.Parent = container

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,60)
title.BackgroundTransparency = 1
title.Text = "ðŸ’– VALENTINE UPGRADE DASHBOARD ðŸ’–"
title.TextScaled = true
title.Font = Enum.Font.GothamBlack
title.TextColor3 = Color3.fromRGB(255,200,220)
title.Parent = container

-- User
local userLabel = Instance.new("TextLabel")
userLabel.Size = UDim2.new(1,0,0,40)
userLabel.BackgroundTransparency = 1
userLabel.Text = "ðŸ‘¤ "..player.Name
userLabel.TextScaled = true
userLabel.Font = Enum.Font.GothamBold
userLabel.TextColor3 = Color3.fromRGB(255,255,255)
userLabel.Parent = container

-- Hearts & Cash
local heartsLabel = Instance.new("TextLabel")
heartsLabel.Size = UDim2.new(1,0,0,40)
heartsLabel.BackgroundTransparency = 1
heartsLabel.TextScaled = true
heartsLabel.Font = Enum.Font.GothamBold
heartsLabel.TextColor3 = Color3.fromRGB(255,255,255)
heartsLabel.Parent = container

local function formatNumber(n)
    local absn = math.abs(n)
    if absn >= 1e12 then
        return string.format("%.2fT", n/1e12)
    elseif absn >= 1e9 then
        return string.format("%.2fB", n/1e9)
    elseif absn >= 1e6 then
        return string.format("%.2fM", n/1e6)
    elseif absn >= 1e3 then
        return string.format("%.1fK", n/1e3)
    else
        return tostring(n)
    end
end

-- Upgrades
local upgradeFrames = {}
local upgradeBars = {}
for _, name in ipairs(upgradeOrder) do
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1,0,0,30)
    frame.BackgroundTransparency = 0.6
    frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
    frame.Parent = container

    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(0,0,1,0)
    bar.BackgroundColor3 = Color3.fromRGB(255,0,150)
    bar.BorderSizePixel = 0
    bar.Parent = frame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.TextScaled = true
    label.Font = Enum.Font.GothamBold
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Text = "ðŸ’˜ "..name
    label.Parent = frame

    upgradeFrames[name] = {frame=frame,label=label}
    upgradeBars[name] = bar
end

-- Status rotating text
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1,0,0,35)
statusLabel.BackgroundTransparency = 1
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextColor3 = Color3.fromRGB(255,255,255)
statusLabel.Parent = container

local rotatingTexts = {
    "â¤ï¸ Collecting Hearts...",
    "ðŸ’¸ Saving for next upgrade",
    "ðŸŽ¯ Next target: Luck",
    "ðŸ”® Upgrade path: Multiplier â†’ Luck â†’ Speed",
    "â³ Waiting for enough Hearts"
}
local currentRotating = 1
task.spawn(function()
    while true do
        statusLabel.Text = rotatingTexts[currentRotating]
        currentRotating = currentRotating + 1
        if currentRotating > #rotatingTexts then currentRotating = 1 end
        task.wait(4)
    end
end)

-- Helper: Hearts & Cash
local function getHearts()
    return player:WaitForChild("SaveVars"):WaitForChild("Hearts2026").Value
end
local function getCash()
    return player:WaitForChild("SaveVars"):WaitForChild("Cash").Value
end

-- Helper: Find current upgrade priority
local function currentPriority(levels)
    for _, name in ipairs(upgradeOrder) do
        if levels[name] < (#UpgradeData[name] or 1) then
            return name
        end
    end
    return "Maxed"
end

-- RenderStepped updates
RunService.RenderStepped:Connect(function()
    local levels = GetUpgrades:InvokeServer()
    local hearts = getHearts()
    local cash = getCash()

    heartsLabel.Text = "â¤ï¸ "..hearts.." | ðŸ’¸ "..formatNumber(cash)

    for _, name in ipairs(upgradeOrder) do
        local current = levels[name] or 0
        local max = UpgradeData[name] and #UpgradeData[name] or 1
        local bar = upgradeBars[name]

        local newSize = UDim2.new(current/max,0,1,0)
        bar.Size = newSize

        upgradeFrames[name].label.Text = "ðŸ’˜ "..name.." | "..current.."/"..max

        if current < max then
            bar.BackgroundColor3 = Color3.fromRGB(255,0,150)
        else
            bar.BackgroundColor3 = Color3.fromRGB(100,100,100)
        end
    end

    local nextTarget = currentPriority(levels)
    if nextTarget ~= "Maxed" then
        statusLabel.Text = "ðŸŽ¯ Upgrading: "..nextTarget.." | Hearts: "..hearts
    else
        statusLabel.Text = "ðŸŽ‰ All upgrades maxed!"
    end
end)
