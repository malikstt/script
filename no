local Network = require(game:GetService("ReplicatedStorage").Modules.Network)
local player = game.Players.LocalPlayer

local WAIT_TIME = 5
local lastItemAddedTime = 0
local tradeStatus = false
local isReady = false
local inTrade = false
local hasTradeItems = false  -- Track whether items have been added to the trade

Network:BindEvents({
    ["TradeRequest"] = function(sender)
        if not inTrade then
            inTrade = true
            Network:FireServer("AcceptTrade", sender)
        end
    end
})

Network:BindEvents({
    ["AddTradeItem"] = function(itemData)
        if tradeStatus then
            lastItemAddedTime = tick()
            isReady = false
            hasTradeItems = true  -- Set flag when a trade item is added
        end
    end,

    ["RemoveTradeItem"] = function(itemData)
        if tradeStatus then
            lastItemAddedTime = tick()
            isReady = false
            -- If trade items are removed and there are no items left, reset flag
            if not hasTradeItems then
                hasTradeItems = false
            end
        end
    end
})

local function shouldReadyUp()
    local timeSinceLastItem = tick() - lastItemAddedTime
    return timeSinceLastItem >= WAIT_TIME and not isReady  -- Ready up after 5 seconds, regardless of items
end

player.PlayerGui.Trading:GetPropertyChangedSignal("Enabled"):Connect(function()
    if player.PlayerGui.Trading.Enabled then
        tradeStatus = true
    else
        tradeStatus = false
    end
end)

local function checkTradeStatus()
    if tradeStatus and shouldReadyUp() then
        Network:FireServer("ReadyUp", false, true)
        isReady = true
    end
end

while true do
    task.wait(1)
    if tradeStatus then
        checkTradeStatus()
    end
end
