-- üåà Rayfield UI
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Utility Control Panel",
    LoadingTitle = "Loading Utilities",
    LoadingSubtitle = "Rayfield UI",
})

local Tab = Window:CreateTab("Main", 4483362458)

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer

-- STATE FLAGS
local ESP_ON = false
local CAMERA_ON = false
local CLAIM_ON = false
local CRATE_ON = false
local TP_ON = false

--------------------------------------------------
-- üî¥ ESP LOOP (ALL PLAYERS)
--------------------------------------------------
task.spawn(function()
    while true do
        if ESP_ON then
            for _, player in ipairs(Players:GetPlayers()) do
                if player.Character then
                    local char = player.Character
                    local h = char:FindFirstChild("ESP_Highlight")
                    if not h then
                        h = Instance.new("Highlight")
                        h.Name = "ESP_Highlight"
                        h.Adornee = char
                        h.Parent = char
                    end
                    h.Enabled = true
                    h.FillColor = Color3.fromRGB(255, 0, 0)
                    h.OutlineColor = Color3.fromRGB(255, 0, 0)
                    h.FillTransparency = 0.4
                    h.OutlineTransparency = 0
                    h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                end
            end
        end
        task.wait(0.5)
    end
end)

--------------------------------------------------
-- üëÅÔ∏è CAMERA LOOP
--------------------------------------------------
task.spawn(function()
    while true do
        if CAMERA_ON then
            LocalPlayer.CameraMode = Enum.CameraMode.Classic
            LocalPlayer.CameraMinZoomDistance = 8
            LocalPlayer.CameraMaxZoomDistance = 50
        end
        task.wait(0.2)
    end
end)

--------------------------------------------------
-- üîÅ CLAIM REWARD LOOP
--------------------------------------------------
task.spawn(function()
    local remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("ClaimReward")
    while true do
        if CLAIM_ON then
            remote:FireServer()
        end
        task.wait(0.5)
    end
end)

--------------------------------------------------
-- üì¶ CRATE LOOP
--------------------------------------------------
task.spawn(function()
    local crateRemote = ReplicatedStorage
        :WaitForChild("RemoteEvents")
        :WaitForChild("crateRemote")

    local args = { "processCrate", 2 }

    while true do
        if CRATE_ON then
            crateRemote:FireServer(unpack(args))
        end
        task.wait(0.3)
    end
end)

--------------------------------------------------
-- üö∂‚Äç‚ôÇÔ∏è TELEPORT TO ALL PLAYERS LOOP
--------------------------------------------------
task.spawn(function()
    while true do
        if TP_ON then
            local char = LocalPlayer.Character
            local root = char and char:FindFirstChild("HumanoidRootPart")

            if root then
                for _, player in ipairs(Players:GetPlayers()) do
                    if not TP_ON then break end
                    if player ~= LocalPlayer and player.Character then
                        local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
                        if targetRoot then
                            root.CFrame = targetRoot.CFrame + Vector3.new(0, 3, 0)
                            task.wait(0.4)
                        end
                    end
                end
            end
        end
        task.wait(0.2)
    end
end)

--------------------------------------------------
-- üß© UI TOGGLES
--------------------------------------------------
Tab:CreateToggle({
    Name = "Red ESP (All Players)",
    CurrentValue = false,
    Callback = function(v)
        ESP_ON = v
    end
})

Tab:CreateToggle({
    Name = "Force Third Person",
    CurrentValue = false,
    Callback = function(v)
        CAMERA_ON = v
    end
})

Tab:CreateToggle({
    Name = "Loop Claim Reward",
    CurrentValue = false,
    Callback = function(v)
        CLAIM_ON = v
    end
})

Tab:CreateToggle({
    Name = "Loop Crate Process",
    CurrentValue = false,
    Callback = function(v)
        CRATE_ON = v
    end
})

Tab:CreateToggle({
    Name = "Teleport To All Players",
    CurrentValue = false,
    Callback = function(v)
        TP_ON = v
    end
})
