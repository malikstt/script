repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local LocalData = require(ReplicatedStorage.Client.Framework.Services.LocalData)

local RemoteEvent = ReplicatedStorage.Shared.Framework.Network.Remote.RemoteEvent
local PickupRemote = ReplicatedStorage.Remotes.Pickups.CollectPickup

local CHRISTMAS = "Christmas World"
local SNOWFLAKE_GREEN = 5000000000
local SNOWFLAKE_RED = 10000000000

local HouseLocations = {
    CFrame.new(-2422, 32, 974),
    CFrame.new(-2415, 32, 999),
    CFrame.new(-2521, 21, 1067),
    CFrame.new(-2711, 32, 1162),
    CFrame.new(-2709, 33, 1194),
    CFrame.new(-2672, 32, 1213),
    CFrame.new(-2450, 32, 972),
    CFrame.new(-2604, 21, 1115),
    CFrame.new(-2601, 21, 1066),
}

local function data()
    return LocalData:Get() or {}
end

local function tp(cf)
    local c = player.Character or player.CharacterAdded:Wait()
    c:WaitForChild("HumanoidRootPart").CFrame = cf
end

local function pressB()
    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.B, false, game)
    task.wait(0.02)
    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.B, false, game)
end

local function makeUI(color, text)
    local gui = Instance.new("ScreenGui")
    gui.IgnoreGuiInset = true
    gui.ResetOnSpawn = false
    gui.Parent = PlayerGui
    local frame = Instance.new("Frame")
    frame.Size = UDim2.fromOffset(200,200)
    frame.Position = UDim2.fromScale(0.5,0.5)
    frame.AnchorPoint = Vector2.new(0.5,0.5)
    frame.BackgroundColor3 = color
    frame.Parent = gui
    local label = Instance.new("TextLabel")
    label.Size = UDim2.fromScale(1,1)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.GothamBold
    label.TextScaled = true
    label.TextColor3 = Color3.new(0,0,0)
    label.Parent = frame
end

RemoteEvent:FireServer("UnlockWorld", CHRISTMAS)
task.wait(6)
RemoteEvent:FireServer("WorldTeleport", CHRISTMAS)
task.wait(5)

task.spawn(function()
    while true do
        local ci = (data().SecretSanta or {}).ClaimedIncentives or {}
        local all = true
        for i = 1, 11 do
            if ci[i] ~= true then
                all = false
                RemoteEvent:FireServer("ClaimSecretSantaIncentive", i)
                task.wait(0.2)
            end
        end
        if all then break end
        task.wait(1)
    end
end)

local pots = {
    {"UsePotion","Speed",6,10},
    {"UsePotion","Speed",7,10},
    {"UsePotion","Lucky",6,10},
    {"UsePotion","Lucky",7,10},
    {"UsePotion","Mythic",6,10},
    {"UsePotion","Mythic",7,10},
    {"UsePotion","Egg Elixir",1,10},
    {"UsePotion","Infinity Elixir",1,10},
    {"UsePotion","Festive Infinity Elixir",1,10},
    {"UsePotion","Ultra Infinity Elixir",1,10},
}

RunService.Heartbeat:Connect(function()
    for _,a in ipairs(pots) do
        RemoteEvent:FireServer(unpack(a))
    end
end)

task.spawn(function()
    while true do
        pressB()
        task.wait(10)
    end
end)

task.spawn(function()
    local claimed = {}
    while true do
        local r = Workspace:FindFirstChild("Rendered")
        if r then
            local t = r:GetChildren()[15]
            if t then
                for _,o in ipairs(t:GetChildren()) do
                    if not claimed[o.Name] then
                        claimed[o.Name] = true
                        pcall(function()
                            PickupRemote:FireServer(o.Name)
                            o:Destroy()
                        end)
                    end
                end
            end
        end
        task.wait(0.1)
    end
end)

local function sweepHouse(baseCF)
    local c = player.Character or player.CharacterAdded:Wait()
    local hrp = c:WaitForChild("HumanoidRootPart")
    hrp.CFrame = baseCF + Vector3.new(0,6,0)
    for i = 1, 5 do
        hrp.CFrame = baseCF + Vector3.new(0,-4,0)
        task.wait(1)
    end
    hrp.CFrame = baseCF + Vector3.new(0,6,0)
    task.wait(1)
    task.wait(10)
end

while true do
    local s = data().Snowflakes or 0
    if s >= SNOWFLAKE_RED then
        makeUI(Color3.fromRGB(200,0,0), "10B SNOWFLAKES SECURED")
        break
    end
    if s >= SNOWFLAKE_GREEN then
        makeUI(Color3.fromRGB(0,200,0), "5B SNOWFLAKES SECURED")
        break
    end
    for _,cf in ipairs(HouseLocations) do
        sweepHouse(cf)
        local ns = data().Snowflakes or 0
        if ns >= SNOWFLAKE_RED or ns >= SNOWFLAKE_GREEN then
            break
        end
    end
end
