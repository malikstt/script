local EGG_NAME = "Candycane Egg"
local AUTO_TELEPORT_GENERIC = true
local AUTO_TELEPORT_RIFTS = true
local MIN_RIFT_LUCK = 0
local CHECK_INTERVAL = 1
local TELEPORT_DEBOUNCE = 2

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local lp = Players.LocalPlayer

local function convertToRiftName(name)
	return name:gsub(" ", "-"):lower()
end

local function getLuck(rift)
	local d = rift:FindFirstChild("Display")
	local g = d and d:FindFirstChildOfClass("SurfaceGui")
	local i = g and g:FindFirstChild("Icon")
	local l = i and i:FindFirstChild("Luck")
	return l and tonumber(l.Text:match("%d+")) or 0
end

local function getModelCFrame(model)
	if not model then return nil end
	if typeof(model.GetPivot) == "function" then
		local ok, pivot = pcall(model.GetPivot, model)
		if ok and pivot then return pivot end
	end
	if model.PrimaryPart then return model.PrimaryPart.CFrame end
	local p = model:FindFirstChildWhichIsA("BasePart", true)
	if p then return p.CFrame end
	return nil
end

local function tpToCFrame(cf)
	if not cf then return end
	local char = lp.Character or lp.CharacterAdded:Wait()
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if hrp then hrp.CFrame = cf + Vector3.new(0,5,0) end
end

local function tpToModel(model)
	local cf = getModelCFrame(model)
	if cf then
		tpToCFrame(cf)
		return true
	end
	return false
end

local lastTeleport = 0
local function canTeleport()
	return (tick() - lastTeleport) >= TELEPORT_DEBOUNCE
end

task.spawn(function()
	local targetRiftName = convertToRiftName(EGG_NAME)
	while true do
		if AUTO_TELEPORT_GENERIC and Workspace:FindFirstChild("Rendered") and Workspace.Rendered:FindFirstChild("Generic") then
			local genericFolder = Workspace.Rendered.Generic
			local eggModel = genericFolder:FindFirstChild(EGG_NAME)
			if eggModel and canTeleport() then
				if tpToModel(eggModel) then
					lastTeleport = tick()
				end
			end
		end

		if AUTO_TELEPORT_RIFTS and Workspace:FindFirstChild("Rendered") and Workspace.Rendered:FindFirstChild("Rifts") then
			local riftsFolder = Workspace.Rendered.Rifts
			local bestRift = nil
			local bestLuck = MIN_RIFT_LUCK
			for _, r in ipairs(riftsFolder:GetChildren()) do
				local typ = r.GetAttribute and r:GetAttribute(r, "Type") or (r:GetAttribute and r:GetAttribute("Type"))
				if typ == "Egg" and r.Name == targetRiftName then
					local luck = getLuck(r) or 0
					if luck > bestLuck then
						bestLuck = luck
						bestRift = r
					end
				end
			end
			if bestRift and canTeleport() then
				if tpToModel(bestRift) then
					lastTeleport = tick()
				end
			end
		end

		task.wait(CHECK_INTERVAL)
	end
end)
