-- üåà Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "Role Teleport & ESP",
    LoadingTitle = "Utility UI",
    LoadingSubtitle = "Rayfield",
})

local Tab = Window:CreateTab("Main", 4483362458)

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

--------------------------------------------------
-- STATES
--------------------------------------------------
local ESP_ON = false
local TP_SEEKER = false
local TP_HIDER = false
local AUTO_ATTACK = false

-- "NONSTOP" or "UNTIL_DEATH"
local MODE = "NONSTOP"

--------------------------------------------------
-- üî¥ RED ESP (ALL PLAYERS)
--------------------------------------------------
task.spawn(function()
    while true do
        for _, player in ipairs(Players:GetPlayers()) do
            local char = player.Character
            if char then
                local h = char:FindFirstChild("ESP_Highlight")
                if ESP_ON then
                    if not h then
                        h = Instance.new("Highlight")
                        h.Name = "ESP_Highlight"
                        h.Adornee = char
                        h.Parent = char
                    end
                    h.Enabled = true
                    h.FillColor = Color3.fromRGB(255, 0, 0)
                    h.OutlineColor = Color3.fromRGB(255, 0, 0)
                    h.FillTransparency = 0.4
                    h.OutlineTransparency = 0
                    h.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                else
                    if h then h:Destroy() end
                end
            end
        end
        task.wait(0.5)
    end
end)

--------------------------------------------------
-- üîé FIND PLAYER BY ROLE
--------------------------------------------------
local function getPlayerByRole(roleName)
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local chars = workspace:FindFirstChild("CHARACTERS")
            local folder = chars and chars:FindFirstChild(player.Name)
            if folder and folder:FindFirstChild(roleName) then
                return player
            end
        end
    end
end

--------------------------------------------------
-- üö∂‚Äç‚ôÇÔ∏è AUTO TP + TARGET LOCK
--------------------------------------------------
local lockedTarget = nil

task.spawn(function()
    while true do
        local myChar = LocalPlayer.Character
        local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")

        if myRoot then
            local role = nil
            if TP_SEEKER then role = "SeekerTitle" end
            if TP_HIDER then role = "HiderTitle" end

            if role then
                if MODE == "NONSTOP" then
                    lockedTarget = getPlayerByRole(role)
                else
                    if not lockedTarget
                    or not lockedTarget.Character
                    or not lockedTarget.Character:FindFirstChildOfClass("Humanoid")
                    or lockedTarget.Character:FindFirstChildOfClass("Humanoid").Health <= 0 then
                        lockedTarget = getPlayerByRole(role)
                    end
                end

                if lockedTarget and lockedTarget.Character then
                    local tRoot = lockedTarget.Character:FindFirstChild("HumanoidRootPart")
                    if tRoot then
                        myRoot.CFrame = tRoot.CFrame + Vector3.new(0, 3, 0)
                    end
                end
            else
                lockedTarget = nil
            end
        end

        task.wait(0.15)
    end
end)

--------------------------------------------------
-- üî™ AUTO ATTACK
--------------------------------------------------
local attackRemote =
    ReplicatedStorage
        :WaitForChild("Assets")
        :WaitForChild("Knife")
        :WaitForChild("Remotes")
        :WaitForChild("Attack")

task.spawn(function()
    while true do
        if AUTO_ATTACK and lockedTarget and lockedTarget.Character then
            local char = LocalPlayer.Character
            local knife = char and char:FindFirstChild("Knife")
            local root = char and char:FindFirstChild("HumanoidRootPart")

            local hum = lockedTarget.Character:FindFirstChildOfClass("Humanoid")

            if knife and root then
                attackRemote:FireServer(
                    os.clock(),
                    knife,
                    root.CFrame,
                    {}
                )
            end

            if MODE == "UNTIL_DEATH" and hum and hum.Health <= 0 then
                AUTO_ATTACK = false
                Rayfield:Notify({
                    Title = "Auto Attack",
                    Content = "Target eliminated.",
                    Duration = 3
                })
            end
        end
        task.wait(0.25)
    end
end)

--------------------------------------------------
-- üß© UI CONTROLS
--------------------------------------------------
Tab:CreateToggle({
    Name = "Red ESP (All Players)",
    CurrentValue = false,
    Callback = function(v)
        ESP_ON = v
    end
})

Tab:CreateToggle({
    Name = "Auto TP to Seeker",
    CurrentValue = false,
    Callback = function(v)
        TP_SEEKER = v
        if v then TP_HIDER = false end
    end
})

Tab:CreateToggle({
    Name = "Auto TP to Hider",
    CurrentValue = false,
    Callback = function(v)
        TP_HIDER = v
        if v then TP_SEEKER = false end
    end
})

Tab:CreateToggle({
    Name = "Auto Attack",
    CurrentValue = false,
    Callback = function(v)
        AUTO_ATTACK = v
        Rayfield:Notify({
            Title = "Auto Attack",
            Content = v and "Enabled" or "Disabled",
            Duration = 2
        })
    end
})

Tab:CreateDropdown({
    Name = "Mode",
    Options = { "NONSTOP", "UNTIL_DEATH" },
    CurrentOption = "NONSTOP",
    Callback = function(opt)
        MODE = opt
        Rayfield:Notify({
            Title = "Mode",
            Content = "Mode set to: "..opt,
            Duration = 2
        })
    end
})
