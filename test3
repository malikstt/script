getgenv().waitTime = 2.5

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
repeat task.wait() until player.Character
local char = player.Character
local hrp = char:WaitForChild("HumanoidRootPart")

local LocalDataModule = require(ReplicatedStorage.Client.Framework.Services.LocalData)
local RemoteFunction = ReplicatedStorage.Shared.Framework.Network.Remote.RemoteFunction

local function getLocalData()
    return LocalDataModule:Get()
end

local function getAmount(name)
    local data = getLocalData()
    return (data and data.Powerups and data.Powerups[name]) or 0
end

local function getDiceRiftChest()
    local rendered = workspace:FindFirstChild("Rendered")
    if not rendered then return end
    local rifts = rendered:FindFirstChild("Rifts")
    if not rifts then return end
    for _, rift in pairs(rifts:GetChildren()) do
        if rift.Name == "dice-rift" then
            local chest = rift:FindFirstChild("Chest", true)
            if chest then
                return chest:FindFirstChildWhichIsA("BasePart")
            end
        end
    end
end

local function setNoClip(state)
    for _, v in pairs(char:GetDescendants()) do
        if v:IsA("BasePart") then
            v.CanCollide = not state
        end
    end
end

local function teleportToChest()
    local chest = getDiceRiftChest()
    if not chest then return end
    setNoClip(true)
    hrp.CFrame = chest.CFrame
    task.wait(0.4)
    setNoClip(false)
end

task.spawn(function()
    while true do
        local start = getAmount("Dice Key")
        if start > 0 then
            local t = tick()
            local changed = false
            while tick() - t < 30 do
                task.wait(1)
                if getAmount("Dice Key") < start then
                    changed = true
                    break
                end
            end
            if not changed and getAmount("Dice Key") > 0 then
                teleportToChest()
            end
        end
        task.wait(2)
    end
end)

task.spawn(function()
    while true do
        if not getDiceRiftChest() then
            local checks = math.random(0,10)
            local found = false
            for i = 1, checks do
                if getDiceRiftChest() then
                    found = true
                    break
                end
                task.wait(1)
            end
            if not found then
                RemoteFunction:InvokeServer(
                    "SummonRift",
                    {
                        Name = "dice-rift",
                        Type = "Chest",
                        Time = 5,
                        World = "Minigame Paradise"
                    }
                )
            end
        end
        task.wait(5)
    end
end)

local gui = Instance.new("ScreenGui")
gui.Name = "DiceUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.fromOffset(200,200)
frame.Position = UDim2.new(0.5,-100,0,10)
frame.BorderSizePixel = 0
frame.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,16)
corner.Parent = frame

local function makeLabel(y, size, bold)
    local l = Instance.new("TextLabel")
    l.Size = UDim2.new(1,-16,0,size)
    l.Position = UDim2.new(0,8,0,y)
    l.BackgroundTransparency = 1
    l.TextScaled = true
    l.Font = bold and Enum.Font.GothamBold or Enum.Font.Gotham
    l.TextColor3 = Color3.new(1,1,1)
    l.Parent = frame
    return l
end

local nameLabel = makeLabel(6,34,true)
local diceKeyLabel = makeLabel(48,38,true)
local superTicketLabel = makeLabel(90,32,false)
local goldenDiceLabel = makeLabel(128,32,false)

RunService.Heartbeat:Connect(function()
    local diceKeys = getAmount("Dice Key")
    local superTickets = getAmount("Super Ticket")
    local goldenDice = getAmount("Golden Dice")

    frame.BackgroundColor3 = diceKeys > 0 and Color3.fromRGB(45,120,255) or Color3.fromRGB(200,45,45)

    nameLabel.Text = "ğŸ‘¤ "..player.Name
    diceKeyLabel.Text = "ğŸ² Dice Key : "..diceKeys
    superTicketLabel.Text = "ğŸŸï¸ Super Ticket : "..superTickets
    goldenDiceLabel.Text = "âœ¨ Golden Dice : "..goldenDice
end)
